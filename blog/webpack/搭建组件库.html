<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>搭建组件库 | Ertsul&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Ertsul's Blog">
    
    <link rel="preload" href="/blog/assets/css/0.styles.4644dc03.css" as="style"><link rel="preload" href="/blog/assets/js/app.05e87176.js" as="script"><link rel="preload" href="/blog/assets/js/2.7b66e441.js" as="script"><link rel="preload" href="/blog/assets/js/43.d6a41bd7.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.ea6bd577.js"><link rel="prefetch" href="/blog/assets/js/11.fdbcd72f.js"><link rel="prefetch" href="/blog/assets/js/12.03dd3a68.js"><link rel="prefetch" href="/blog/assets/js/13.9f83acb2.js"><link rel="prefetch" href="/blog/assets/js/14.0d53b731.js"><link rel="prefetch" href="/blog/assets/js/15.87dc1f9b.js"><link rel="prefetch" href="/blog/assets/js/16.adecebbe.js"><link rel="prefetch" href="/blog/assets/js/17.435cdc45.js"><link rel="prefetch" href="/blog/assets/js/18.fb8309ad.js"><link rel="prefetch" href="/blog/assets/js/19.e7f2aba0.js"><link rel="prefetch" href="/blog/assets/js/20.e84bb42f.js"><link rel="prefetch" href="/blog/assets/js/21.1f595c63.js"><link rel="prefetch" href="/blog/assets/js/22.4445cd0f.js"><link rel="prefetch" href="/blog/assets/js/23.96d4f535.js"><link rel="prefetch" href="/blog/assets/js/24.7af03a34.js"><link rel="prefetch" href="/blog/assets/js/25.d0857cfb.js"><link rel="prefetch" href="/blog/assets/js/26.45b2d5c3.js"><link rel="prefetch" href="/blog/assets/js/27.8ee0720c.js"><link rel="prefetch" href="/blog/assets/js/28.9decd080.js"><link rel="prefetch" href="/blog/assets/js/29.3adfb8b4.js"><link rel="prefetch" href="/blog/assets/js/3.9df8d16a.js"><link rel="prefetch" href="/blog/assets/js/30.a1fab330.js"><link rel="prefetch" href="/blog/assets/js/31.c0712d9f.js"><link rel="prefetch" href="/blog/assets/js/32.79c8d8cd.js"><link rel="prefetch" href="/blog/assets/js/33.beae7573.js"><link rel="prefetch" href="/blog/assets/js/34.3005a7a2.js"><link rel="prefetch" href="/blog/assets/js/35.4b13eddf.js"><link rel="prefetch" href="/blog/assets/js/36.88a0ab51.js"><link rel="prefetch" href="/blog/assets/js/37.fd66de9f.js"><link rel="prefetch" href="/blog/assets/js/38.9365037e.js"><link rel="prefetch" href="/blog/assets/js/39.f76aca0d.js"><link rel="prefetch" href="/blog/assets/js/4.43c9f4e3.js"><link rel="prefetch" href="/blog/assets/js/40.2b243fae.js"><link rel="prefetch" href="/blog/assets/js/41.55a29e42.js"><link rel="prefetch" href="/blog/assets/js/42.fb0219f6.js"><link rel="prefetch" href="/blog/assets/js/5.35be8bf9.js"><link rel="prefetch" href="/blog/assets/js/6.eea0b903.js"><link rel="prefetch" href="/blog/assets/js/7.a73ccded.js"><link rel="prefetch" href="/blog/assets/js/8.7d9fcf73.js"><link rel="prefetch" href="/blog/assets/js/9.aa2fdecf.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.4644dc03.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Ertsul's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tags" class="dropdown-title"><span class="title">Tags</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tags" class="mobile-dropdown-title"><span class="title">Tags</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/vue-source-code/Vue 源码阅读1 引入vue模块/" class="nav-link">
  Vue 源码
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue/svg sprite/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/blog/js/EC AO VO Scope Chain/" class="nav-link">
  JS
</a></li><li class="dropdown-item"><!----> <a href="/blog/flutter/flutter 知识点记录/" class="nav-link">
  Flutter
</a></li><li class="dropdown-item"><!----> <a href="/blog/web-safe/web-safe/" class="nav-link">
  Web Safe
</a></li><li class="dropdown-item"><!----> <a href="/blog/webpack/webpack学习笔记/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/blog/minapp/小程序工程化/" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/blog/low-code-platform/可视化搭建平台（一）- 流程/" class="nav-link">
  可视化搭建平台
</a></li><li class="dropdown-item"><!----> <a href="/blog/css/3D立体骰子/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/blog/git/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/blog/algorithm/广度优先搜索 BFS 和深度优先搜索 DFS/" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/blog/others/v8 引擎及其 GC 机制/" class="nav-link">
  其他
</a></li></ul></div></div><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/Ertsul/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tags" class="dropdown-title"><span class="title">Tags</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tags" class="mobile-dropdown-title"><span class="title">Tags</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/vue-source-code/Vue 源码阅读1 引入vue模块/" class="nav-link">
  Vue 源码
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue/svg sprite/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/blog/js/EC AO VO Scope Chain/" class="nav-link">
  JS
</a></li><li class="dropdown-item"><!----> <a href="/blog/flutter/flutter 知识点记录/" class="nav-link">
  Flutter
</a></li><li class="dropdown-item"><!----> <a href="/blog/web-safe/web-safe/" class="nav-link">
  Web Safe
</a></li><li class="dropdown-item"><!----> <a href="/blog/webpack/webpack学习笔记/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/blog/minapp/小程序工程化/" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/blog/low-code-platform/可视化搭建平台（一）- 流程/" class="nav-link">
  可视化搭建平台
</a></li><li class="dropdown-item"><!----> <a href="/blog/css/3D立体骰子/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/blog/git/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/blog/algorithm/广度优先搜索 BFS 和深度优先搜索 DFS/" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/blog/others/v8 引擎及其 GC 机制/" class="nav-link">
  其他
</a></li></ul></div></div><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/Ertsul/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/webpack/webpack学习笔记.html" class="sidebar-link">webpack学习笔记</a></li><li><a href="/blog/webpack/搭建组件库.html" class="active sidebar-link">搭建组件库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/webpack/搭建组件库.html#创建-vue-项目" class="sidebar-link">创建 vue 项目</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/搭建组件库.html#添加生成组件库-webpack-配置" class="sidebar-link">添加生成组件库 webpack 配置</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/搭建组件库.html#修改-package-json-入口" class="sidebar-link">修改 package.json 入口</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/搭建组件库.html#发布" class="sidebar-link">发布</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/搭建组件库.html#优化" class="sidebar-link">优化</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="搭建组件库"><a href="#搭建组件库" class="header-anchor">#</a> 搭建组件库</h1> <p>利用 webpack，通过入口将所有的组件模块导入并且注册，然后通过生成一个 bundle.js 文件即可。</p> <h2 id="创建-vue-项目"><a href="#创建-vue-项目" class="header-anchor">#</a> 创建 vue 项目</h2> <p>创建 vue 项目，除了 vue 项目自带的文件目录外，在根目录下添加以下目录结构：</p> <div class="language-txt extra-class"><pre class="language-txt"><code>└───build 目录：主要存放 webpack 相关配置
| 	└───webpack.build.config.js // 打包生成组件库 webpack 配置
|───lib 目录：打包生成的 bundle.js 目录
| 	└───bundle.js // 打包生成的 bundle
|───packages
|   └───index.js // 注册所有组件脚本文件
| 	└───组件名称 1
| 		└───src
| 			└───index.vue // 组件源码
| 		└───index.js // 单个组件注册
| 	└───组件名称 2
| 		└───src
| 			└───index.vue // 组件源码
| 		└───index.js // 单个组件注册
| 	└───组件名称 n
| 	└───...
</code></pre></div><h2 id="添加生成组件库-webpack-配置"><a href="#添加生成组件库-webpack-配置" class="header-anchor">#</a> 添加生成组件库 webpack 配置</h2> <p>配置目录：<code>build/webpack.biuld.config.js</code></p> <h3 id="entry"><a href="#entry" class="header-anchor">#</a> entry</h3> <p>入口作用：入口将所有的组件模块导入并且注册。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    xx<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../packages/index.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="output"><a href="#output" class="header-anchor">#</a> output</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../lib'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    publicPath<span class="token operator">:</span> <span class="token string">'/lib/'</span><span class="token punctuation">,</span>
    library<span class="token operator">:</span> <span class="token string">'xx'</span><span class="token punctuation">,</span> <span class="token comment">// 包名</span>
    libraryTarget<span class="token operator">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span>
    umdNamedDefine<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其中，<a href="https://webpack.docschina.org/configuration/output/#outputlibrarytarget" target="_blank" rel="noopener noreferrer">libraryTarget<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 采用 umd 格式。</p> <blockquote><p>打包后的 library 暴露为所有的模块定义下都可运行的方式。它将在 CommonJS, AMD 环境下运行，或将模块导出到 global 下的变量。</p></blockquote> <h3 id="loader"><a href="#loader" class="header-anchor">#</a> loader</h3> <p>babel-loader（@babel/preset-env、@babel/transform-runtime、dynamic-import-webpack）、vue-loader、css-loader、postcss-loader、sass-loader、url-loader。</p> <p>静态资源如图片等统一转化成 base64，后面统一使用 iconfont 的方式使用图标。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif|svg|ttf|woff|woff2|eot)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
                    options<span class="token operator">:</span> <span class="token punctuation">{</span>
                        limit<span class="token operator">:</span> <span class="token number">10240000</span><span class="token punctuation">,</span>
                        name<span class="token operator">:</span> <span class="token string">'static/[name].[hash:6].[ext]'</span><span class="token punctuation">,</span>
                        esModule<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// https://webpack.docschina.org/loaders/url-loader/#esmodule</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token comment">// 将 JS 字符串生成为 style 节点</span>
                <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
                <span class="token comment">// 将 CSS 转化成 CommonJS 模块</span>
                <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.s[ac]ss$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token comment">// 将 JS 字符串生成为 style 节点</span>
                <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
                <span class="token comment">// 将 CSS 转化成 CommonJS 模块</span>
                <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                <span class="token comment">// 将 Sass 编译成 CSS</span>
                <span class="token string">'sass-loader'</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
            exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.vue$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            loader<span class="token operator">:</span> <span class="token string">'vue-loader'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="plugins"><a href="#plugins" class="header-anchor">#</a> plugins</h3> <p>vue-loader</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">VueLoaderPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>LoaderOptionsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span>
            errorDetails<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="externals"><a href="#externals" class="header-anchor">#</a> externals</h3> <p><a href="https://webpack.docschina.org/configuration/externals/" target="_blank" rel="noopener noreferrer">externals 文档链接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p><strong>防止</strong>将某些 <code>import</code> 的包(package)<strong>打包</strong>到 bundle 中，而是在运行时(runtime)再去从外部获取这些<em>扩展依赖(external dependencies)</em>。</p></blockquote> <p>由于是封装组件库，有使用到如 element-ui 等第三方依赖，所以不需要再对第三方依赖包进行打包。在安装私有库的时候，会自动安装第三方依赖。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>externals<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        vue<span class="token operator">:</span> <span class="token punctuation">{</span>
            root<span class="token operator">:</span> <span class="token string">'Vue'</span><span class="token punctuation">,</span>
            commonjs<span class="token operator">:</span> <span class="token string">'vue'</span><span class="token punctuation">,</span>
            commonjs2<span class="token operator">:</span> <span class="token string">'vue'</span><span class="token punctuation">,</span>
            amd<span class="token operator">:</span> <span class="token string">'vue'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        lodash<span class="token operator">:</span> <span class="token punctuation">{</span>
            root<span class="token operator">:</span> <span class="token string">'lodash'</span><span class="token punctuation">,</span>
            commonjs<span class="token operator">:</span> <span class="token string">'lodash'</span><span class="token punctuation">,</span>
            commonjs2<span class="token operator">:</span> <span class="token string">'lodash'</span><span class="token punctuation">,</span>
            amd<span class="token operator">:</span> <span class="token string">'lodash'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// 'element-ui': 'element-ui',</span>
        vuedraggable<span class="token operator">:</span> <span class="token string">'vuedraggable'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">element-ui[\s\S]+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">ig</span></span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="修改-package-json-入口"><a href="#修改-package-json-入口" class="header-anchor">#</a> 修改 package.json 入口</h2> <p>package.json 入口指向打包好的 bundle.js</p> <div class="language-txt extra-class"><pre class="language-txt"><code>{
	// ...
	&quot;main&quot;: &quot;lib/xx.js&quot;
}
</code></pre></div><h2 id="发布"><a href="#发布" class="header-anchor">#</a> 发布</h2> <h3 id="方式一-发布到-npm"><a href="#方式一-发布到-npm" class="header-anchor">#</a> 方式一： 发布到 npm</h3> <p>通过 npm publish 发布到 npm 上，使用的时候通过 <code>npm i xx</code> 即可。</p> <h3 id="方式二-放到个人-gitlab-github"><a href="#方式二-放到个人-gitlab-github" class="header-anchor">#</a> 方式二：放到个人 gitlab / github</h3> <p>使用的时候，添加依赖到 package.json 中：</p> <div class="language-txt extra-class"><pre class="language-txt"><code>&quot;xxx&quot;: &quot;git+https://xxxxx.git&quot;,
</code></pre></div><p>删除 node_modules，重新安装依赖即可。</p> <hr> <h2 id="优化"><a href="#优化" class="header-anchor">#</a> 优化</h2> <p>原先打包处理的之后一个 bundle.js，这样在实际使用过程中没法做到按需加载。【<a href="https://segmentfault.com/a/1190000012794598#articleHeader0" target="_blank" rel="noopener noreferrer">参考链接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>】</p> <p>在打包过程中，因为是全量加载，这样冗余代码都会被打包，这样明显是不合理的。</p> <p>主要做两个优化：</p> <ul><li>优化打包策略</li></ul> <ul><li><s>配合插件 <a href="https://github.com/ElementUI/babel-plugin-component" target="_blank" rel="noopener noreferrer">babel-plugin-component<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 使用</s></li> <li>配合 Babel 插件 <a href="https://www.npmjs.com/package/babel-plugin-import" target="_blank" rel="noopener noreferrer">babel-plugin-import<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 使用</li></ul> <h4 id="插件使用"><a href="#插件使用" class="header-anchor">#</a> 插件使用</h4> <p><a href="https://www.npmjs.com/package/babel-plugin-import" target="_blank" rel="noopener noreferrer">babel-plugin-import<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 这个插件会对 import 进行转化。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span>
  <span class="token string">'import'</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    libraryName<span class="token operator">:</span> <span class="token string">'xxx'</span><span class="token punctuation">,</span> <span class="token comment">// 包名</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'xxx'</span><span class="token punctuation">,</span> <span class="token comment">// 包名</span>
<span class="token punctuation">]</span>
</code></pre></div><p>转化前：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'xxx'</span>
</code></pre></div><p>转化为：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> button <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'xxx/lib/button/index.js'</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="调整打包策略"><a href="#调整打包策略" class="header-anchor">#</a> 调整打包策略</h4> <p>这样除了 bundle.js，还需要将每个组件打包成独立的组件目录。</p> <p>lib 目录结构调整如下：</p> <div class="language-txt extra-class"><pre class="language-txt"><code>|───lib 目录：打包生成的 bundle.js 目录
| 	└───bundle.js // 打包生成的 bundle
| 	└───组件一
| 		└───index.js
| 	└───组件 n
| 		└───index.js
</code></pre></div><p>通过 webpack 多入口实现，其他配置不变，添加以下配置：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * 获取 packages 下所有组件目录的名称和对应的路径, 生成所有的 entry
 * @returns entry
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">getWebpackEntries</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    entry<span class="token operator">:</span> <span class="token function">getWebpackEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 多入口</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        filename<span class="token operator">:</span> <span class="token string">'[name]/index.js'</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../lib/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        libraryTarget<span class="token operator">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span>
        globalObject<span class="token operator">:</span> <span class="token string">'this'</span><span class="token punctuation">,</span>
        umdNamedDefine<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="打包后的文件大小对比"><a href="#打包后的文件大小对比" class="header-anchor">#</a> 打包后的文件大小对比</h4> <p><img src="https://i.loli.net/2021/04/14/YpEhXAdNBlCy4Rc.png" alt="image.png"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/webpack/webpack学习笔记.html" class="prev">
        webpack学习笔记
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.05e87176.js" defer></script><script src="/blog/assets/js/2.7b66e441.js" defer></script><script src="/blog/assets/js/43.d6a41bd7.js" defer></script>
  </body>
</html>
