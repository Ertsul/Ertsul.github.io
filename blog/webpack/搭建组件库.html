<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>搭建组件库 | Ertsul&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="shortcut icon" type="image/png" sizes="32x32" href="https://s2.loli.net/2022/04/02/uCOBfH6XgGUEdPt.png">
    <link rel="shortcut icon" type="image/png" sizes="16x16" href="https://s2.loli.net/2022/04/02/uCOBfH6XgGUEdPt.png">
    <style type="text/css">.logo {height: 2.2rem!important; width: 2.2rem!important;border-radius: 100%;margin-right: 0.8rem;vertical-align: top;}</style>
    <meta name="description" content="记录所学">
    
    <link rel="preload" href="/blog/assets/css/0.styles.214aaa3c.css" as="style"><link rel="preload" href="/blog/assets/js/app.24552706.js" as="script"><link rel="preload" href="/blog/assets/js/2.9a122aa2.js" as="script"><link rel="preload" href="/blog/assets/js/67.0adb4437.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.c6459277.js"><link rel="prefetch" href="/blog/assets/js/11.8692c733.js"><link rel="prefetch" href="/blog/assets/js/12.8a55f766.js"><link rel="prefetch" href="/blog/assets/js/13.7585f9d1.js"><link rel="prefetch" href="/blog/assets/js/14.e94109eb.js"><link rel="prefetch" href="/blog/assets/js/15.5e07c399.js"><link rel="prefetch" href="/blog/assets/js/16.7cfea898.js"><link rel="prefetch" href="/blog/assets/js/17.f3f10ee7.js"><link rel="prefetch" href="/blog/assets/js/18.ccdff12f.js"><link rel="prefetch" href="/blog/assets/js/19.216aa4d3.js"><link rel="prefetch" href="/blog/assets/js/20.3d0bb1e8.js"><link rel="prefetch" href="/blog/assets/js/21.06bf2c78.js"><link rel="prefetch" href="/blog/assets/js/22.ea0b7ad3.js"><link rel="prefetch" href="/blog/assets/js/23.f91b7e7f.js"><link rel="prefetch" href="/blog/assets/js/24.b19daeaf.js"><link rel="prefetch" href="/blog/assets/js/25.c8bc0a32.js"><link rel="prefetch" href="/blog/assets/js/26.4f8f8ad0.js"><link rel="prefetch" href="/blog/assets/js/27.7d53f981.js"><link rel="prefetch" href="/blog/assets/js/28.736b9717.js"><link rel="prefetch" href="/blog/assets/js/29.14a4e98e.js"><link rel="prefetch" href="/blog/assets/js/3.59ec874e.js"><link rel="prefetch" href="/blog/assets/js/30.366e6853.js"><link rel="prefetch" href="/blog/assets/js/31.2f3e159f.js"><link rel="prefetch" href="/blog/assets/js/32.7e9d5499.js"><link rel="prefetch" href="/blog/assets/js/33.b47731a3.js"><link rel="prefetch" href="/blog/assets/js/34.36c7de93.js"><link rel="prefetch" href="/blog/assets/js/35.16d70ca9.js"><link rel="prefetch" href="/blog/assets/js/36.b60f5904.js"><link rel="prefetch" href="/blog/assets/js/37.7cba5470.js"><link rel="prefetch" href="/blog/assets/js/38.e5ed72a4.js"><link rel="prefetch" href="/blog/assets/js/39.3c6ec6d8.js"><link rel="prefetch" href="/blog/assets/js/4.2d3c4328.js"><link rel="prefetch" href="/blog/assets/js/40.c5ab5215.js"><link rel="prefetch" href="/blog/assets/js/41.95d69cc3.js"><link rel="prefetch" href="/blog/assets/js/42.e05442a8.js"><link rel="prefetch" href="/blog/assets/js/43.4062455d.js"><link rel="prefetch" href="/blog/assets/js/44.42d31b08.js"><link rel="prefetch" href="/blog/assets/js/45.4b26c1ea.js"><link rel="prefetch" href="/blog/assets/js/46.5f3b1d60.js"><link rel="prefetch" href="/blog/assets/js/47.28c02989.js"><link rel="prefetch" href="/blog/assets/js/48.aee476de.js"><link rel="prefetch" href="/blog/assets/js/49.5aec821f.js"><link rel="prefetch" href="/blog/assets/js/5.7d8a0b03.js"><link rel="prefetch" href="/blog/assets/js/50.a1e4bf59.js"><link rel="prefetch" href="/blog/assets/js/51.ea5fd6a1.js"><link rel="prefetch" href="/blog/assets/js/52.d232ee88.js"><link rel="prefetch" href="/blog/assets/js/53.14f726fb.js"><link rel="prefetch" href="/blog/assets/js/54.5ff641c5.js"><link rel="prefetch" href="/blog/assets/js/55.9ab375d0.js"><link rel="prefetch" href="/blog/assets/js/56.dd346453.js"><link rel="prefetch" href="/blog/assets/js/57.8ec85ad2.js"><link rel="prefetch" href="/blog/assets/js/58.954dcfc3.js"><link rel="prefetch" href="/blog/assets/js/59.d53cb6ad.js"><link rel="prefetch" href="/blog/assets/js/6.290bb4e8.js"><link rel="prefetch" href="/blog/assets/js/60.84e97981.js"><link rel="prefetch" href="/blog/assets/js/61.4a595ec6.js"><link rel="prefetch" href="/blog/assets/js/62.d5aa2848.js"><link rel="prefetch" href="/blog/assets/js/63.9f4f17b7.js"><link rel="prefetch" href="/blog/assets/js/64.6620d437.js"><link rel="prefetch" href="/blog/assets/js/65.d1d1ea86.js"><link rel="prefetch" href="/blog/assets/js/66.7fbe658f.js"><link rel="prefetch" href="/blog/assets/js/68.cb37de69.js"><link rel="prefetch" href="/blog/assets/js/7.ca690a1e.js"><link rel="prefetch" href="/blog/assets/js/8.60719c31.js"><link rel="prefetch" href="/blog/assets/js/9.edfd3b4d.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.214aaa3c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="https://avatars.githubusercontent.com/u/17139306?v=4" alt="Ertsul's Blog" class="logo"> <span class="site-name can-hide">Ertsul's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="分类" class="mobile-dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/vue-source-code/Vue 源码阅读1 引入vue模块/" class="nav-link">
  Vue 源码
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue3-source-code/vue3 响应式原理/" class="nav-link">
  vue3 源码
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue-router/vue-router 源码阅读（一）/" class="nav-link">
  vue-router 源码
</a></li><li class="dropdown-item"><!----> <a href="/blog/vuex/vuex 源码阅读/" class="nav-link">
  vuex 源码阅读
</a></li><li class="dropdown-item"><!----> <a href="/blog/question-source-code/vue-template-compiler template 编译流程/" class="nav-link">
  带着问题看源码
</a></li><li class="dropdown-item"><!----> <a href="/blog/router/前端路由/" class="nav-link">
  前端路由
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue/svg sprite/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue-ssr/vue-srr 项目搭建/" class="nav-link">
  Vue SSR
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/EC AO VO Scope Chain/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/blog/flutter/flutter 知识点记录/" class="nav-link">
  Flutter
</a></li><li class="dropdown-item"><!----> <a href="/blog/webpack/webpack学习笔记/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/blog/low-code-platform/可视化搭建平台（一）- 流程/" class="nav-link">
  可视化搭建平台
</a></li><li class="dropdown-item"><!----> <a href="/blog/algorithm/广度优先搜索 BFS 和深度优先搜索 DFS/" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/blog/css/3D立体骰子/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/blog/git/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/blog/web-safe/web-safe/" class="nav-link">
  Web Safe
</a></li><li class="dropdown-item"><!----> <a href="/blog/minapp/小程序工程化/" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/blog/others/v8 引擎及其 GC 机制/" class="nav-link">
  其他
</a></li></ul></div></div><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div> <a href="https://github.com/Ertsul/" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="分类" class="mobile-dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/vue-source-code/Vue 源码阅读1 引入vue模块/" class="nav-link">
  Vue 源码
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue3-source-code/vue3 响应式原理/" class="nav-link">
  vue3 源码
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue-router/vue-router 源码阅读（一）/" class="nav-link">
  vue-router 源码
</a></li><li class="dropdown-item"><!----> <a href="/blog/vuex/vuex 源码阅读/" class="nav-link">
  vuex 源码阅读
</a></li><li class="dropdown-item"><!----> <a href="/blog/question-source-code/vue-template-compiler template 编译流程/" class="nav-link">
  带着问题看源码
</a></li><li class="dropdown-item"><!----> <a href="/blog/router/前端路由/" class="nav-link">
  前端路由
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue/svg sprite/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue-ssr/vue-srr 项目搭建/" class="nav-link">
  Vue SSR
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/EC AO VO Scope Chain/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/blog/flutter/flutter 知识点记录/" class="nav-link">
  Flutter
</a></li><li class="dropdown-item"><!----> <a href="/blog/webpack/webpack学习笔记/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/blog/low-code-platform/可视化搭建平台（一）- 流程/" class="nav-link">
  可视化搭建平台
</a></li><li class="dropdown-item"><!----> <a href="/blog/algorithm/广度优先搜索 BFS 和深度优先搜索 DFS/" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/blog/css/3D立体骰子/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/blog/git/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/blog/web-safe/web-safe/" class="nav-link">
  Web Safe
</a></li><li class="dropdown-item"><!----> <a href="/blog/minapp/小程序工程化/" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/blog/others/v8 引擎及其 GC 机制/" class="nav-link">
  其他
</a></li></ul></div></div><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div> <a href="https://github.com/Ertsul/" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/blog/webpack/webpack学习笔记.html" class="sidebar-link">webpack学习笔记</a></li><li><a href="/blog/webpack/搭建组件库.html" class="active sidebar-link">搭建组件库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/webpack/搭建组件库.html#创建-vue-项目" class="sidebar-link">创建 vue 项目</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/搭建组件库.html#添加生成组件库-webpack-配置" class="sidebar-link">添加生成组件库 webpack 配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/webpack/搭建组件库.html#entry" class="sidebar-link">entry</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/搭建组件库.html#output" class="sidebar-link">output</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/搭建组件库.html#loader" class="sidebar-link">loader</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/搭建组件库.html#plugins" class="sidebar-link">plugins</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/搭建组件库.html#externals" class="sidebar-link">externals</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/webpack/搭建组件库.html#修改-package-json-入口" class="sidebar-link">修改 package.json 入口</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/搭建组件库.html#发布" class="sidebar-link">发布</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/webpack/搭建组件库.html#方式一-发布到-npm" class="sidebar-link">方式一： 发布到 npm</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/搭建组件库.html#方式二-放到个人-gitlab-github" class="sidebar-link">方式二：放到个人 gitlab / github</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/webpack/搭建组件库.html#优化" class="sidebar-link">优化</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="搭建组件库"><a href="#搭建组件库" class="header-anchor">#</a> 搭建组件库</h1> <p>利用 webpack，通过入口将所有的组件模块导入并且注册，然后通过生成一个 bundle.js 文件即可。</p> <h2 id="创建-vue-项目"><a href="#创建-vue-项目" class="header-anchor">#</a> 创建 vue 项目</h2> <p>创建 vue 项目，除了 vue 项目自带的文件目录外，在根目录下添加以下目录结构：</p> <div class="language-txt extra-class"><pre class="language-txt"><code>└───build 目录：主要存放 webpack 相关配置
| 	└───webpack.build.config.js // 打包生成组件库 webpack 配置
|───lib 目录：打包生成的 bundle.js 目录
| 	└───bundle.js // 打包生成的 bundle
|───packages
|   └───index.js // 注册所有组件脚本文件
| 	└───组件名称 1
| 		└───src
| 			└───index.vue // 组件源码
| 		└───index.js // 单个组件注册
| 	└───组件名称 2
| 		└───src
| 			└───index.vue // 组件源码
| 		└───index.js // 单个组件注册
| 	└───组件名称 n
| 	└───...
</code></pre></div><h2 id="添加生成组件库-webpack-配置"><a href="#添加生成组件库-webpack-配置" class="header-anchor">#</a> 添加生成组件库 webpack 配置</h2> <p>配置目录：<code>build/webpack.biuld.config.js</code></p> <h3 id="entry"><a href="#entry" class="header-anchor">#</a> entry</h3> <p>入口作用：入口将所有的组件模块导入并且注册。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">xx</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../packages/index.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="output"><a href="#output" class="header-anchor">#</a> output</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../lib'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">publicPath</span><span class="token operator">:</span> <span class="token string">'/lib/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token string">'xx'</span><span class="token punctuation">,</span> <span class="token comment">// 包名</span>
    <span class="token literal-property property">libraryTarget</span><span class="token operator">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">umdNamedDefine</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其中，<a href="https://webpack.docschina.org/configuration/output/#outputlibrarytarget" target="_blank" rel="noopener noreferrer">libraryTarget<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 采用 umd 格式。</p> <blockquote><p>打包后的 library 暴露为所有的模块定义下都可运行的方式。它将在 CommonJS, AMD 环境下运行，或将模块导出到 global 下的变量。</p></blockquote> <h3 id="loader"><a href="#loader" class="header-anchor">#</a> loader</h3> <p>babel-loader（@babel/preset-env、@babel/transform-runtime、dynamic-import-webpack）、vue-loader、css-loader、postcss-loader、sass-loader、url-loader。</p> <p>静态资源如图片等统一转化成 base64，后面统一使用 iconfont 的方式使用图标。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif|svg|ttf|woff|woff2|eot)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">10240000</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'static/[name].[hash:6].[ext]'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">esModule</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// https://webpack.docschina.org/loaders/url-loader/#esmodule</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token comment">// 将 JS 字符串生成为 style 节点</span>
                <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
                <span class="token comment">// 将 CSS 转化成 CommonJS 模块</span>
                <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.s[ac]ss$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token comment">// 将 JS 字符串生成为 style 节点</span>
                <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
                <span class="token comment">// 将 CSS 转化成 CommonJS 模块</span>
                <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                <span class="token comment">// 将 Sass 编译成 CSS</span>
                <span class="token string">'sass-loader'</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.vue$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'vue-loader'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="plugins"><a href="#plugins" class="header-anchor">#</a> plugins</h3> <p>vue-loader</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">VueLoaderPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>LoaderOptionsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">errorDetails</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="externals"><a href="#externals" class="header-anchor">#</a> externals</h3> <p><a href="https://webpack.docschina.org/configuration/externals/" target="_blank" rel="noopener noreferrer">externals 文档链接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p><strong>防止</strong>将某些 <code>import</code> 的包(package)<strong>打包</strong>到 bundle 中，而是在运行时(runtime)再去从外部获取这些<em>扩展依赖(external dependencies)</em>。</p></blockquote> <p>由于是封装组件库，有使用到如 element-ui 等第三方依赖，所以不需要再对第三方依赖包进行打包。在安装私有库的时候，会自动安装第三方依赖。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token literal-property property">externals</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">vue</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token string">'Vue'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">commonjs</span><span class="token operator">:</span> <span class="token string">'vue'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">commonjs2</span><span class="token operator">:</span> <span class="token string">'vue'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">amd</span><span class="token operator">:</span> <span class="token string">'vue'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">lodash</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token string">'lodash'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">commonjs</span><span class="token operator">:</span> <span class="token string">'lodash'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">commonjs2</span><span class="token operator">:</span> <span class="token string">'lodash'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">amd</span><span class="token operator">:</span> <span class="token string">'lodash'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// 'element-ui': 'element-ui',</span>
        <span class="token literal-property property">vuedraggable</span><span class="token operator">:</span> <span class="token string">'vuedraggable'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">element-ui[\s\S]+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">ig</span></span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="修改-package-json-入口"><a href="#修改-package-json-入口" class="header-anchor">#</a> 修改 package.json 入口</h2> <p>package.json 入口指向打包好的 bundle.js</p> <div class="language-txt extra-class"><pre class="language-txt"><code>{
	// ...
	&quot;main&quot;: &quot;lib/xx.js&quot;
}
</code></pre></div><h2 id="发布"><a href="#发布" class="header-anchor">#</a> 发布</h2> <h3 id="方式一-发布到-npm"><a href="#方式一-发布到-npm" class="header-anchor">#</a> 方式一： 发布到 npm</h3> <p>通过 npm publish 发布到 npm 上，使用的时候通过 <code>npm i xx</code> 即可。</p> <h3 id="方式二-放到个人-gitlab-github"><a href="#方式二-放到个人-gitlab-github" class="header-anchor">#</a> 方式二：放到个人 gitlab / github</h3> <p>使用的时候，添加依赖到 package.json 中：</p> <div class="language-txt extra-class"><pre class="language-txt"><code>&quot;xxx&quot;: &quot;git+https://xxxxx.git&quot;,
</code></pre></div><p>删除 node_modules，重新安装依赖即可。</p> <hr> <h2 id="优化"><a href="#优化" class="header-anchor">#</a> 优化</h2> <p>原先打包处理的之后一个 bundle.js，这样在实际使用过程中没法做到按需加载。【<a href="https://segmentfault.com/a/1190000012794598#articleHeader0" target="_blank" rel="noopener noreferrer">参考链接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>】</p> <p>在打包过程中，因为是全量加载，这样冗余代码都会被打包，这样明显是不合理的。</p> <p>主要做两个优化：</p> <ul><li>优化打包策略</li></ul> <ul><li><s>配合插件 <a href="https://github.com/ElementUI/babel-plugin-component" target="_blank" rel="noopener noreferrer">babel-plugin-component<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 使用</s></li> <li>配合 Babel 插件 <a href="https://www.npmjs.com/package/babel-plugin-import" target="_blank" rel="noopener noreferrer">babel-plugin-import<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 使用</li></ul> <h4 id="插件使用"><a href="#插件使用" class="header-anchor">#</a> 插件使用</h4> <p><a href="https://www.npmjs.com/package/babel-plugin-import" target="_blank" rel="noopener noreferrer">babel-plugin-import<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 这个插件会对 import 进行转化。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span>
  <span class="token string">'import'</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">libraryName</span><span class="token operator">:</span> <span class="token string">'xxx'</span><span class="token punctuation">,</span> <span class="token comment">// 包名</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'xxx'</span><span class="token punctuation">,</span> <span class="token comment">// 包名</span>
<span class="token punctuation">]</span>
</code></pre></div><p>转化前：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'xxx'</span>
</code></pre></div><p>转化为：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> button <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'xxx/lib/button/index.js'</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="调整打包策略"><a href="#调整打包策略" class="header-anchor">#</a> 调整打包策略</h4> <p>这样除了 bundle.js，还需要将每个组件打包成独立的组件目录。</p> <p>lib 目录结构调整如下：</p> <div class="language-txt extra-class"><pre class="language-txt"><code>|───lib 目录：打包生成的 bundle.js 目录
| 	└───bundle.js // 打包生成的 bundle
| 	└───组件一
| 		└───index.js
| 	└───组件 n
| 		└───index.js
</code></pre></div><p>通过 webpack 多入口实现，其他配置不变，添加以下配置：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * 获取 packages 下所有组件目录的名称和对应的路径, 生成所有的 entry
 * @returns entry
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">getWebpackEntries</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token function">getWebpackEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 多入口</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'[name]/index.js'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../lib/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">libraryTarget</span><span class="token operator">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">globalObject</span><span class="token operator">:</span> <span class="token string">'this'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">umdNamedDefine</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="打包后的文件大小对比"><a href="#打包后的文件大小对比" class="header-anchor">#</a> 打包后的文件大小对比</h4> <p><img src="https://i.loli.net/2021/04/14/YpEhXAdNBlCy4Rc.png" alt="image.png"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/webpack/webpack学习笔记.html" class="prev">
        webpack学习笔记
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/blog/assets/js/app.24552706.js" defer></script><script src="/blog/assets/js/2.9a122aa2.js" defer></script><script src="/blog/assets/js/67.0adb4437.js" defer></script>
  </body>
</html>
