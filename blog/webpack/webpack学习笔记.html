<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>项目构建 | Ertsul&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="shortcut icon" type="image/png" sizes="32x32" href="https://s2.loli.net/2022/04/02/uCOBfH6XgGUEdPt.png">
    <link rel="shortcut icon" type="image/png" sizes="16x16" href="https://s2.loli.net/2022/04/02/uCOBfH6XgGUEdPt.png">
    <style type="text/css">.logo {height: 2.2rem!important; width: 2.2rem!important;border-radius: 100%;margin-right: 0.8rem;vertical-align: top;}</style>
    <meta name="description" content="记录所学">
    
    <link rel="preload" href="/blog/assets/css/0.styles.214aaa3c.css" as="style"><link rel="preload" href="/blog/assets/js/app.a0842275.js" as="script"><link rel="preload" href="/blog/assets/js/2.9a122aa2.js" as="script"><link rel="preload" href="/blog/assets/js/6.41dc5a45.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.f37e0e76.js"><link rel="prefetch" href="/blog/assets/js/11.39fe0eae.js"><link rel="prefetch" href="/blog/assets/js/12.67cdbb49.js"><link rel="prefetch" href="/blog/assets/js/13.7b877ab9.js"><link rel="prefetch" href="/blog/assets/js/14.b3199019.js"><link rel="prefetch" href="/blog/assets/js/15.5e07c399.js"><link rel="prefetch" href="/blog/assets/js/16.7cfea898.js"><link rel="prefetch" href="/blog/assets/js/17.b1ef214d.js"><link rel="prefetch" href="/blog/assets/js/18.82a96266.js"><link rel="prefetch" href="/blog/assets/js/19.216aa4d3.js"><link rel="prefetch" href="/blog/assets/js/20.c8432713.js"><link rel="prefetch" href="/blog/assets/js/21.957fe7af.js"><link rel="prefetch" href="/blog/assets/js/22.0aa22e7b.js"><link rel="prefetch" href="/blog/assets/js/23.8af7c372.js"><link rel="prefetch" href="/blog/assets/js/24.57e49b6f.js"><link rel="prefetch" href="/blog/assets/js/25.81acd47b.js"><link rel="prefetch" href="/blog/assets/js/26.4f8f8ad0.js"><link rel="prefetch" href="/blog/assets/js/27.2c78cdfa.js"><link rel="prefetch" href="/blog/assets/js/28.736b9717.js"><link rel="prefetch" href="/blog/assets/js/29.adf164b1.js"><link rel="prefetch" href="/blog/assets/js/3.858ec5b1.js"><link rel="prefetch" href="/blog/assets/js/30.366e6853.js"><link rel="prefetch" href="/blog/assets/js/31.1ec7fe1d.js"><link rel="prefetch" href="/blog/assets/js/32.1d9c8421.js"><link rel="prefetch" href="/blog/assets/js/33.b47731a3.js"><link rel="prefetch" href="/blog/assets/js/34.9c78a100.js"><link rel="prefetch" href="/blog/assets/js/35.49a653fd.js"><link rel="prefetch" href="/blog/assets/js/36.b60f5904.js"><link rel="prefetch" href="/blog/assets/js/37.24e953ef.js"><link rel="prefetch" href="/blog/assets/js/38.77401b31.js"><link rel="prefetch" href="/blog/assets/js/39.012c1347.js"><link rel="prefetch" href="/blog/assets/js/4.799bb18f.js"><link rel="prefetch" href="/blog/assets/js/40.feeafda1.js"><link rel="prefetch" href="/blog/assets/js/41.4484aee3.js"><link rel="prefetch" href="/blog/assets/js/42.e05442a8.js"><link rel="prefetch" href="/blog/assets/js/43.4062455d.js"><link rel="prefetch" href="/blog/assets/js/44.81414c7e.js"><link rel="prefetch" href="/blog/assets/js/45.38cd8645.js"><link rel="prefetch" href="/blog/assets/js/46.269c6b6e.js"><link rel="prefetch" href="/blog/assets/js/47.803bb00f.js"><link rel="prefetch" href="/blog/assets/js/48.6ecf27ac.js"><link rel="prefetch" href="/blog/assets/js/49.c72a7309.js"><link rel="prefetch" href="/blog/assets/js/5.880e79fc.js"><link rel="prefetch" href="/blog/assets/js/50.32555d87.js"><link rel="prefetch" href="/blog/assets/js/51.c0e21315.js"><link rel="prefetch" href="/blog/assets/js/52.0f2e1ad0.js"><link rel="prefetch" href="/blog/assets/js/53.5848013e.js"><link rel="prefetch" href="/blog/assets/js/54.35c6cec2.js"><link rel="prefetch" href="/blog/assets/js/55.425c93fd.js"><link rel="prefetch" href="/blog/assets/js/56.c247e2a8.js"><link rel="prefetch" href="/blog/assets/js/57.1691e780.js"><link rel="prefetch" href="/blog/assets/js/58.3d0dbb6e.js"><link rel="prefetch" href="/blog/assets/js/59.18d97c5c.js"><link rel="prefetch" href="/blog/assets/js/60.a3d45da6.js"><link rel="prefetch" href="/blog/assets/js/61.1e522707.js"><link rel="prefetch" href="/blog/assets/js/62.603ce257.js"><link rel="prefetch" href="/blog/assets/js/63.16c67f1f.js"><link rel="prefetch" href="/blog/assets/js/64.f7d8cb8d.js"><link rel="prefetch" href="/blog/assets/js/65.5d9c2572.js"><link rel="prefetch" href="/blog/assets/js/66.ab107c5a.js"><link rel="prefetch" href="/blog/assets/js/67.eab13c91.js"><link rel="prefetch" href="/blog/assets/js/7.303b47c7.js"><link rel="prefetch" href="/blog/assets/js/8.4ed71331.js"><link rel="prefetch" href="/blog/assets/js/9.edfd3b4d.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.214aaa3c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="https://avatars.githubusercontent.com/u/17139306?v=4" alt="Ertsul's Blog" class="logo"> <span class="site-name can-hide">Ertsul's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="分类" class="mobile-dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/vue-source-code/Vue 源码阅读1 引入vue模块/" class="nav-link">
  Vue 源码
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue3-source-code/vue3 响应式原理/" class="nav-link">
  vue3 源码
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue-router/vue-router 源码阅读（一）/" class="nav-link">
  vue-router 源码
</a></li><li class="dropdown-item"><!----> <a href="/blog/vuex/vuex 源码阅读/" class="nav-link">
  vuex 源码阅读
</a></li><li class="dropdown-item"><!----> <a href="/blog/question-source-code/vue-template-compiler template 编译流程/" class="nav-link">
  带着问题看源码
</a></li><li class="dropdown-item"><!----> <a href="/blog/router/前端路由/" class="nav-link">
  前端路由
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue/svg sprite/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue-ssr/vue-srr 项目搭建/" class="nav-link">
  Vue SSR
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/EC AO VO Scope Chain/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/blog/flutter/flutter 知识点记录/" class="nav-link">
  Flutter
</a></li><li class="dropdown-item"><!----> <a href="/blog/webpack/webpack学习笔记/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/blog/low-code-platform/可视化搭建平台（一）- 流程/" class="nav-link">
  可视化搭建平台
</a></li><li class="dropdown-item"><!----> <a href="/blog/algorithm/广度优先搜索 BFS 和深度优先搜索 DFS/" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/blog/css/3D立体骰子/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/blog/git/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/blog/web-safe/web-safe/" class="nav-link">
  Web Safe
</a></li><li class="dropdown-item"><!----> <a href="/blog/minapp/小程序工程化/" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/blog/others/v8 引擎及其 GC 机制/" class="nav-link">
  其他
</a></li></ul></div></div><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div> <a href="https://github.com/Ertsul/" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="分类" class="mobile-dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/vue-source-code/Vue 源码阅读1 引入vue模块/" class="nav-link">
  Vue 源码
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue3-source-code/vue3 响应式原理/" class="nav-link">
  vue3 源码
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue-router/vue-router 源码阅读（一）/" class="nav-link">
  vue-router 源码
</a></li><li class="dropdown-item"><!----> <a href="/blog/vuex/vuex 源码阅读/" class="nav-link">
  vuex 源码阅读
</a></li><li class="dropdown-item"><!----> <a href="/blog/question-source-code/vue-template-compiler template 编译流程/" class="nav-link">
  带着问题看源码
</a></li><li class="dropdown-item"><!----> <a href="/blog/router/前端路由/" class="nav-link">
  前端路由
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue/svg sprite/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue-ssr/vue-srr 项目搭建/" class="nav-link">
  Vue SSR
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/EC AO VO Scope Chain/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/blog/flutter/flutter 知识点记录/" class="nav-link">
  Flutter
</a></li><li class="dropdown-item"><!----> <a href="/blog/webpack/webpack学习笔记/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/blog/low-code-platform/可视化搭建平台（一）- 流程/" class="nav-link">
  可视化搭建平台
</a></li><li class="dropdown-item"><!----> <a href="/blog/algorithm/广度优先搜索 BFS 和深度优先搜索 DFS/" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/blog/css/3D立体骰子/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/blog/git/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/blog/web-safe/web-safe/" class="nav-link">
  Web Safe
</a></li><li class="dropdown-item"><!----> <a href="/blog/minapp/小程序工程化/" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/blog/others/v8 引擎及其 GC 机制/" class="nav-link">
  其他
</a></li></ul></div></div><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div> <a href="https://github.com/Ertsul/" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/blog/webpack/webpack学习笔记.html" class="active sidebar-link">webpack学习笔记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/webpack/webpack学习笔记.html#项目构建" class="sidebar-link">项目构建</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/webpack学习笔记.html#模式-mode" class="sidebar-link">模式 mode</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/webpack学习笔记.html#入口-entry" class="sidebar-link">入口 entry</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/webpack学习笔记.html#输出-output" class="sidebar-link">输出 output</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/webpack学习笔记.html#webpack-dev-server" class="sidebar-link">webpack-dev-server</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/webpack学习笔记.html#source-map-eval-source-map-cheap-module-source-map-cheap-module-eval-source-map" class="sidebar-link">source-map &amp;&amp; eval-source-map &amp;&amp; cheap-module-source-map &amp;&amp; cheap-module-eval-source-map</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/webpack学习笔记.html#watch" class="sidebar-link">watch</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/webpack学习笔记.html#resolve" class="sidebar-link">resolve</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/webpack学习笔记.html#插件" class="sidebar-link">插件</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/webpack学习笔记.html#模块-module" class="sidebar-link">模块 module</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/webpack学习笔记.html#模块-module-noparse" class="sidebar-link">模块 module -- noParse</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/webpack学习笔记.html#模块-module-exclude" class="sidebar-link">模块 module -- exclude</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/webpack学习笔记.html#模块-module-include" class="sidebar-link">模块 module -- include</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/webpack学习笔记.html#区分不同环境-实现开发和生产配置的分离" class="sidebar-link">区分不同环境，实现开发和生产配置的分离</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/webpack学习笔记.html#webpack-自带优化" class="sidebar-link">webpack 自带优化</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/webpack学习笔记.html#webpack-懒加载" class="sidebar-link">webpack 懒加载</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/webpack学习笔记.html#热更新-热替换-hot-module-replacement-hmr" class="sidebar-link">热更新 / 热替换 / Hot Module Replacement / HMR</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/webpack学习笔记.html#多线程打包" class="sidebar-link">多线程打包</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/webpack学习笔记.html#多页面打包" class="sidebar-link">多页面打包</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/webpack学习笔记.html#多页面打包抽离公共代码块" class="sidebar-link">多页面打包抽离公共代码块</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/webpack学习笔记.html#tapable" class="sidebar-link">Tapable</a></li></ul></li><li><a href="/blog/webpack/搭建组件库.html" class="sidebar-link">搭建组件库</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="项目构建"><a href="#项目构建" class="header-anchor">#</a> 项目构建</h2> <ul><li>新建项目文件夹</li> <li>npm init</li> <li>设置项目目录结构，结构如下：</li></ul> <p><img src="/blog/assets/img/webpack-01.622a49d7.png" alt="image.png"></p> <ul><li><strong>build</strong> 目录是 webpack 打包后的生成目录，<strong>index.html</strong> 是打包后的 html 文件，bundle.hash.js 是打包后的 js 文件。</li> <li><strong>src</strong> 目录是项目源文件，<strong>template.html</strong> 是 html 文件模板。</li> <li><strong>webpack.config.js</strong> 是配置 <strong>webpack</strong> 的总文件。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
</code></pre></div><h2 id="模式-mode"><a href="#模式-mode" class="header-anchor">#</a> 模式 mode</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span> <span class="token comment">// development or production</span>
</code></pre></div><h2 id="入口-entry"><a href="#入口-entry" class="header-anchor">#</a> 入口 entry</h2> <p>设置打包的入口文件, entry: filepath</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 入口</span>
</code></pre></div><h2 id="输出-output"><a href="#输出-output" class="header-anchor">#</a> 输出 output</h2> <p>设置打包后的输出文件，output: { ... }</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 输出</span>
  <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;bundle.[hash:8].js&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/build'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// publicPath: &quot;http://&quot;, // 公共路径前缀</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>注：</p> <ul><li><strong>path</strong> 后面应是绝对路径。</li> <li><strong>bundle.[hash:8].js</strong> 中的 <strong>[hash:8]</strong> 可以在每次打包后都在文件后面追加 hash 值。</li></ul> <p>通过上面三项，可以实现一个简单的 <strong>webpack</strong> 打包配置。在 <strong>package.json</strong> 添加脚本或直接执行 <strong>./node_modules/.bin/webpack</strong> 即可实现打包：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./node_modules/.bin/webpack&quot;</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="webpack-dev-server"><a href="#webpack-dev-server" class="header-anchor">#</a> webpack-dev-server</h2> <p>webpack 开发服务器，用于开发时候的配置：</p> <ul><li>yarn add taco --dev webpack-dev-server / npm install --save-dev webpack-dev-server</li> <li>基本配置如下：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 开发服务器</span>
  <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">3001</span><span class="token punctuation">,</span>
  <span class="token literal-property property">contentBase</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/build'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 本地服务器目录</span>
  <span class="token literal-property property">progress</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 进度条</span>
  <span class="token literal-property property">open</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 自动打开浏览器</span>
  <span class="token literal-property property">compress</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 压缩</span>
  <span class="token comment">// 1. 代理</span>
  <span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;/api&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">pathRewrite</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;/api&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 2. 用 express 内置钩子模拟数据</span>
  <span class="token function">before</span><span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 3. 在服务端中启动 webpack 服务，使用 webpack-dev-middleware 中间件</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><ul><li>在 <strong>package.json</strong> 添加脚本即可：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string-property property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-dev-server&quot;</span>
</code></pre></div><h2 id="source-map-eval-source-map-cheap-module-source-map-cheap-module-eval-source-map"><a href="#source-map-eval-source-map-cheap-module-source-map-cheap-module-eval-source-map" class="header-anchor">#</a> source-map &amp;&amp; eval-source-map &amp;&amp; cheap-module-source-map &amp;&amp; cheap-module-eval-source-map</h2> <p>作用：源码映射，报错时显示出错的位置。</p> <ul><li>source-map：会单独生成一个 <strong>sourcemap</strong> 文件；会显示行列。</li> <li>eval-source-map：不会单独生成一个 <strong>sourcemap</strong> 文件，会将生成的 <strong>sourcemap</strong> 放到打包后的 <strong>html</strong> 文件；会显示行和列。</li> <li>cheap-module-source-map：会生成 <strong>sourcemap</strong> 文件，不会显示列。</li> <li>cheap-module-eval-source-map：不会生成 <strong>sourcemap</strong> 文件，集成在 <strong>html</strong> 文件中，不会显示列。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">&quot;source-map&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 源码映射</span>
</code></pre></div><h2 id="watch"><a href="#watch" class="header-anchor">#</a> watch</h2> <p>作用：监控代码实时变化，进行编译打包。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 监控代码实时变化，进行编译打包</span>
<span class="token literal-property property">watchOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">poll</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token comment">// 多毫秒监控一次</span>
  <span class="token literal-property property">aggreatement</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token comment">// 防抖</span>
  <span class="token literal-property property">ignored</span><span class="token operator">:</span> <span class="token string">&quot;node_modules&quot;</span> <span class="token comment">// 忽略文件夹</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="resolve"><a href="#resolve" class="header-anchor">#</a> resolve</h2> <p>作用：解析第三方包</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 解析 第三方包</span>
  <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 在当前目录下查找模块 </span>
    path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;other_modules&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 在其他目录下查找模块 </span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 自动添加扩展名，主要是 import 时候使用, 依次解析</span>
  <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.css&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.vue&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 比如引用 bootstrap 的 css 样式</span>
  <span class="token comment">// 方式一： bootstrap 的主入口</span>
  <span class="token literal-property property">mainFields</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;style&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;main&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 方式二：别名  </span>
  <span class="token comment">// alias: {</span>
  <span class="token comment">//   bootstrap: &quot;bootstrap/dist/css/bootstrap.css&quot;</span>
  <span class="token comment">// }</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="插件"><a href="#插件" class="header-anchor">#</a> 插件</h2> <p>webpack 的插件配置是一个数组，里面存放着各种各样的插件。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
 <span class="token keyword">new</span> <span class="token class-name">pluginName</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h4 id="html-webpack-plugin"><a href="#html-webpack-plugin" class="header-anchor">#</a> html-webpack-plugin</h4> <p>插件作用：打包时候自动根据 <strong>html</strong> 模板生成目标 <strong>html</strong> 文件，自动生成目标打包目录；另外，可配置 <strong>html</strong> 的相关打包配置，如：压缩，去双引号等。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;index.html&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 目标文件名称</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/src/template.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 模板文件</span>
  <span class="token literal-property property">minify</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 压缩配置</span>
    <span class="token literal-property property">removeAttributeQuotes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 去双引号</span>
    <span class="token literal-property property">collapseWhitespace</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 不换行</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">hash</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 生成 hash 戳</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="mini-css-extract-plugin"><a href="#mini-css-extract-plugin" class="header-anchor">#</a> mini-css-extract-plugin</h4> <p>作用：将生成的 <strong>css样式</strong> 抽离成一个 <strong>css文件</strong>，并将该样式文件引进目标 <strong>html</strong> 文件中。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// 插件</span>
  <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;main.css&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 模块</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// {</span>
      <span class="token comment">//   loader: &quot;style-loader&quot;,</span>
      <span class="token comment">//   options: {</span>
      <span class="token comment">//     insertAt: &quot;top&quot; // 插到 head 标签的顶部，更改优先级</span>
      <span class="token comment">//   }</span>
      <span class="token comment">// },</span>
      MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span> <span class="token comment">// 注意 loader 的使用顺序</span>
      <span class="token string">&quot;css-loader&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注：这里抽离出来的 <strong>main.css</strong> 文件并没有压缩，要通过手动添加以下两个插件到优化项：</p> <ul><li>optimize-css-assets-webpack-plugin</li> <li>uglifyjs-webpack-plugin</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 优化项</span>
  <span class="token literal-property property">minimizer</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">OptimizeCssAssetsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 压缩抽离的 css 文件</span>
    <span class="token keyword">new</span> <span class="token class-name">UglifyjsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">parallel</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 使用了 optimize-css-assets-webpack-plugin 插件后，原先的 js 压缩不起作用，要手动重新配置</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="optimize-css-assets-webpack-plugin"><a href="#optimize-css-assets-webpack-plugin" class="header-anchor">#</a> optimize-css-assets-webpack-plugin</h4> <p>插件作用：压缩抽离出来的 <strong>main.css</strong> 文件。但是，使用了 <strong>optimize-css-assets-webpack-plugin</strong> 插件后，原先的 js 压缩不起作用，要手动重新配置优化项 <strong>uglifyjs-webpack-plugin</strong> 。</p> <h4 id="uglifyjs-webpack-plugin"><a href="#uglifyjs-webpack-plugin" class="header-anchor">#</a> uglifyjs-webpack-plugin</h4> <p>插件作用：压缩打包后的 <strong>js</strong> 文件。</p> <h4 id="clean-webpack-plugin"><a href="#clean-webpack-plugin" class="header-anchor">#</a> clean-webpack-plugin</h4> <p>作用：清理文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
 <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token string">&quot;./build&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h4 id="copy-webpack-plugin"><a href="#copy-webpack-plugin" class="header-anchor">#</a> copy-webpack-plugin</h4> <p>作用：将某些文件拷贝到打包后的文件夹。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">CopyWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span><span class="token literal-property property">from</span><span class="token operator">:</span> <span class="token string">&quot;./copy&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">to</span><span class="token operator">:</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="banner-plugin"><a href="#banner-plugin" class="header-anchor">#</a> banner-plugin</h4> <p>作用：版权声明，是 <strong>webpack</strong> 的内置模块。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>BannerPlugin</span><span class="token punctuation">(</span><span class="token string">&quot;@copyright by Ertsul&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="webpack-defineplugin"><a href="#webpack-defineplugin" class="header-anchor">#</a> webpack.DefinePlugin({ ... })</h4> <p>作用：定义环境变量。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token constant">DEV</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">&quot;development&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token constant">PRO</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">&quot;production&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h4 id="webpacfk-ignoreplugin"><a href="#webpacfk-ignoreplugin" class="header-anchor">#</a> webpacfk.IgnorePlugin()</h4> <p>作用：忽略模块的引进</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>IgnorePlugin</span><span class="token punctuation">(</span><span class="token operator">/</span>\<span class="token punctuation">.</span><span class="token operator">/</span>locale<span class="token operator">/</span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">moment</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><p>注：如果直接使用 <strong>DEV: 'development'</strong> 的话，会把 <strong>DEV</strong> 直接替换为 <strong>引号内部的内容</strong>。如：<strong>console.log(DEV)</strong>，会变成 <strong>console.log(dev)</strong>，最后的结果是 <strong>undefined</strong>。所以，需要通过 <strong>JSON.stringfy()</strong> 进行转化。</p> <h2 id="模块-module"><a href="#模块-module" class="header-anchor">#</a> 模块 module</h2> <p>模块主要是各种 <strong>loader</strong>，作用：解析各种类型的文件。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
 <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
   <span class="token punctuation">{</span>
     <span class="token literal-property property">test</span><span class="token operator">:</span> regx<span class="token punctuation">,</span>
     <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>loadName<span class="token punctuation">]</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="css-loader-style-loader"><a href="#css-loader-style-loader" class="header-anchor">#</a> css-loader / style-loader</h4> <ul><li>css-loader：主要是用于解析在 <strong>css</strong> 文件中通过 <strong>@import</strong> 方式引进其他的 <strong>css</strong> 文件。</li> <li>style-loader: 主要是用于将 <strong>js</strong> 文件中通过 <strong>require</strong> 方式引进的 <strong>css</strong> 文件插入到目标 <strong>html</strong> 文件的 <strong>head</strong> 中（插到最后，层级最高）。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 数组方式</span>
<span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 模块</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 正则</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">]</span> <span class="token comment">// loader 数组</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment">// 对象方式</span>
<span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 模块</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 正则</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">insertAt</span><span class="token operator">:</span> <span class="token string">&quot;top&quot;</span> <span class="token comment">// 插到 head 标签的顶部，更改优先级</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> 
      <span class="token string">&quot;css-loader&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注：<strong>loader</strong> 是从右向左、从下到上的执行顺序，故：<strong>use: [&quot;style-loader&quot;, &quot;css-loader&quot;]</strong></p> <h4 id="postcss-loader-autoprefixer"><a href="#postcss-loader-autoprefixer" class="header-anchor">#</a> postcss-loader + autoprefixer</h4> <p>这两个的配合使用可以自动添加 <strong>css</strong> 的浏览器前缀。</p> <ul><li>autoprefixer：自动添加 <strong>css</strong> 的浏览器前缀。</li> <li>postcss-loader：loader 处理 autoprefixer。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用 postcss-loader </span>
<span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 模块</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// {</span>
      <span class="token comment">//   loader: &quot;style-loader&quot;,</span>
      <span class="token comment">//   options: {</span>
      <span class="token comment">//     insertAt: &quot;top&quot; // 插到 head 标签的顶部，更改优先级</span>
      <span class="token comment">//   }</span>
      <span class="token comment">// },</span>
      MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
      <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;postcss-loader&quot;</span> <span class="token comment">// 注意顺序</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>根目录下新建 postcss.config.js 文件</li></ul> <div class="language- extra-class"><pre class="language-text"><code>module.exports = {
  plugins: [
    require(&quot;autoprefixer&quot;)
  ]
}
</code></pre></div><h4 id="babel-loader-babel-core-babel-preset-env"><a href="#babel-loader-babel-core-babel-preset-env" class="header-anchor">#</a> babel-loader + @babel/core + @babel/preset-env</h4> <p>作用：转化 es6 语法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 模块</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 用 babel-loader 需要把 es6 转化为 es5</span>
        <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 转化 js 语法，一个大的 babel 库，包含将 es6 转化为 es5 的模块</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment">// plugins: [...] // 其他的小插件</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="expose-loader"><a href="#expose-loader" class="header-anchor">#</a> expose-loader</h4> <p>作用：暴露全局的 <strong>loader</strong>，暴露到 <strong>window</strong> 上。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 一般情况</span>
<span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">'jquery'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
<span class="token comment">// 内联 loader 方式</span>
<span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">'expose-loader?$!jquery'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 其他方式：在每个模块中注入</span>
<span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">$</span><span class="token operator">:</span> <span class="token string">&quot;jquery&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
</code></pre></div><h4 id="file-loader-url-loader-html-withimg-loader"><a href="#file-loader-url-loader-html-withimg-loader" class="header-anchor">#</a> file-loader &amp;&amp; url-loader &amp;&amp; html-withimg-loader</h4> <p>在 <strong>webpack</strong> 项目中不能直接使用相对路径的方式调用图片，不然打包后的图片路径会报错。</p> <ul><li>file-loader：<strong>js</strong> 文件中通过 <strong>import</strong> 方式引进图片。</li> <li>html-withimg-loader：<strong>html</strong> 文件中通过 <strong>scr</strong> 方式引进图片。</li> <li>在 <strong>css</strong> 中使用图片，<strong>style-loader</strong> 已经做了处理。</li> <li>url-loader：将图片转化为 <strong>base64</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpg|gif)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">200</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token comment">// 图片小于 200k，变成 base64，否则用 file-loader</span>
          <span class="token comment">// publicPath: &quot;http://&quot;, // 公共路径前缀</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.html$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;html-withimg-loader&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>`</p> <h2 id="模块-module-noparse"><a href="#模块-module-noparse" class="header-anchor">#</a> 模块 module -- noParse</h2> <p>作用：不解析指定包的依赖关系。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">noParse</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">jquery</span><span class="token regex-delimiter">/</span></span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="模块-module-exclude"><a href="#模块-module-exclude" class="header-anchor">#</a> 模块 module -- exclude</h2> <p>作用：排除</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_module</span><span class="token regex-delimiter">/</span></span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="模块-module-include"><a href="#模块-module-include" class="header-anchor">#</a> 模块 module -- include</h2> <p>作用：包含</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">src</span><span class="token regex-delimiter">/</span></span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="区分不同环境-实现开发和生产配置的分离"><a href="#区分不同环境-实现开发和生产配置的分离" class="header-anchor">#</a> 区分不同环境，实现开发和生产配置的分离</h2> <p>将 <strong>webpack</strong> 的配置文件划分为以下文件：</p> <ul><li>webpack.base.js：基本、共有的配置。</li> <li>webpack.dev.js：开发配置。</li> <li>webpack.prod.js：生产配置。</li></ul> <p>使用 <strong>webpack-merger</strong> 插件：</p> <ul><li>安装 <strong>webpack-merge</strong> 插件；</li> <li>引进目标模块</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> smart <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;webpack-merge&quot;</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>使用</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> base <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>&quot;webpack<span class="token punctuation">.</span>base<span class="token punctuation">.</span>js<span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">smart</span><span class="token punctuation">(</span>base<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="webpack-自带优化"><a href="#webpack-自带优化" class="header-anchor">#</a> webpack 自带优化</h2> <ul><li><strong>import</strong> 语法（生成环境），<strong>tree-shaking</strong> 自动删除没有用到的代码；</li> <li><strong>es6</strong> 模块会把语法放到 <strong>default</strong> 上；</li> <li>自动省略可以简化的代码；</li> <li><strong>scope hosting</strong>，作用域提升。</li></ul> <h2 id="webpack-懒加载"><a href="#webpack-懒加载" class="header-anchor">#</a> webpack 懒加载</h2> <ul><li>通过 <strong>import</strong> 实现（该语法内部由 <strong>jsonp</strong> 实现），返回的是一个 <strong>promise</strong>。</li> <li>要在 <strong>babel-loader</strong> 中添加 <strong>@babel/plugin-syntax-dynamic-import</strong> 插件。</li> <li><strong>vue</strong> 和 <strong>react</strong> 的l懒加载都是这样实现的。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/*
* 模拟点击加载 source.js 的内容
*/</span>
<span class="token comment">// 1</span>
<span class="token punctuation">{</span>
  <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">'@babel/preset-env'</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">'@babel/plugin-syntax-dynamic-import'</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">// 2</span>
<span class="token keyword">let</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
btn<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'btn'</span><span class="token punctuation">;</span>
btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 内部由 jsonp 实现动态加载文件</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./source.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>btn<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>点击按钮后结果如下：</p> <p><img src="data:image/png;base64,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" alt="image.png"></p> <h2 id="热更新-热替换-hot-module-replacement-hmr"><a href="#热更新-热替换-hot-module-replacement-hmr" class="header-anchor">#</a> 热更新 / 热替换 / Hot Module Replacement / HMR</h2> <p>热更新：页面只更新改动的模块。</p> <ul><li><strong>devServer</strong> 开始 <strong>hot</strong> 热更新模块。</li> <li>使用 <strong>webpack</strong> 内置热更新插件。
<ul><li>NamedModulesPlugin</li> <li>HotModuleReplacementPlugin</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// devServer 配置</span>
<span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8089</span><span class="token punctuation">,</span>
  <span class="token literal-property property">contentBase</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/dist/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">compress</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">progress</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// open: true</span>
  <span class="token literal-property property">hot</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 开启热更新，只更新更改的模块</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 添加插件</span>
<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>NamedModulesPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 热更新打印更新的模块路径</span>
  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 热更新</span>
<span class="token punctuation">]</span>
</code></pre></div><ul><li>使用热更新</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> source <span class="token keyword">from</span> <span class="token string">'./source.js'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 添加热更新操作，不然不会实现热更新</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">'./source.js'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./source.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="多线程打包"><a href="#多线程打包" class="header-anchor">#</a> 多线程打包</h2> <p>使用 <strong>happypack</strong> 可以实现多线程打包。</p> <ul><li>安装并引进 <strong>happypack</strong>;</li> <li>改写 <strong>module</strong>;</li> <li><strong>plugin</strong> 配置。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 改写 module</span>
<span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token comment">// use: {</span>
      <span class="token comment">//   loader: 'babel-loader',</span>
      <span class="token comment">//   options: {</span>
      <span class="token comment">//     presets: [</span>
      <span class="token comment">//       '@babel/preset-env'</span>
      <span class="token comment">//     ]</span>
      <span class="token comment">//   }</span>
      <span class="token comment">// }</span>
      <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'Happypack/loader?id=js'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment">// plugin 配置</span>
<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">Happypack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">'@babel/preset-env'</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="多页面打包"><a href="#多页面打包" class="header-anchor">#</a> 多页面打包</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">home</span><span class="token operator">:</span> <span class="token string">&quot;./src/home.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">about</span><span class="token operator">:</span> <span class="token string">&quot;./src/about.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">other</span><span class="token operator">:</span> <span class="token string">&quot;./src/other.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">&quot;/build/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">template</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">&quot;/src/template.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;home.html&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;home&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">template</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">&quot;/src/template.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;other.html&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;other&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">template</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">&quot;/src/template.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;about.html&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;about&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="多页面打包抽离公共代码块"><a href="#多页面打包抽离公共代码块" class="header-anchor">#</a> 多页面打包抽离公共代码块</h2> <p>打包 <strong>多页面</strong> 需要将公共的代码块抽离出来进行优化：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">optimation</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">// 分割代码块</span>
    <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">// 缓存组</span>
      <span class="token literal-property property">common</span><span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">// 公共的模块</span>
        <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">'initial'</span><span class="token punctuation">,</span>  <span class="token comment">// 从哪里开始，initial 即：入口</span>
        <span class="token literal-property property">miniSize</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment">// 大小大于多少字节的时候抽离</span>
        <span class="token literal-property property">miniChunks</span><span class="token operator">:</span> <span class="token number">2</span>  <span class="token comment">// 引用多少次的时候抽离</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">vender</span><span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">// 第三方模块</span>
        <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment">// 设置权重，没有设置权重的话，代码默认从上到下执行，上面的公共代码会先将第三方模块抽离出来，达不到抽离第三方模块的作用</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>  <span class="token comment">// 抽离出来</span>
        <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">'initial'</span><span class="token punctuation">,</span>  <span class="token comment">// 从哪里开始，initial 即：入口</span>
        <span class="token literal-property property">miniSize</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment">// 大小大于多少字节的时候抽离</span>
        <span class="token literal-property property">miniChunks</span><span class="token operator">:</span> <span class="token number">2</span>  <span class="token comment">// 引用多少次的时候抽离</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="tapable"><a href="#tapable" class="header-anchor">#</a> Tapable</h2> <p><strong>webpack</strong> 本质是事件流的机制，工作流程就是将各个插件串联起来，实现核心就是 <strong>Tapable</strong>，通过 <strong>Tapable</strong> 实现各种钩子（如同步钩子异步钩子）。而 <strong>Tapable</strong> 核心是依赖于 <strong>发布订阅者模式</strong>。</p> <ul><li>同步钩子基本思路（发布订阅者模式）：将所有注册的函数存放到一个任务数组，发布的时候所有订阅者都会执行。使用 <strong>tap</strong> 注册。</li></ul> <p>使用：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> SyncHook <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'tapable'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Hook</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">arch</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 注册监听事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>arch<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>arch<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 开始</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">arch</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'Ertsul'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> h <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
h<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
h<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>异步钩子基本思路（发布订阅者模式）：将所有注册的函数存放到一个任务数组，发布的时候所有订阅者都会执行。使用 <strong>tapAsync</strong> 注册。</li></ul> <p>setTimeout()方式使用：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> AsyncParallelHook <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'tapable'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AsyncHook</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">arch</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncParallelHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>arch<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cb <span class="token operator">&amp;&amp;</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>arch<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cb <span class="token operator">&amp;&amp;</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>arch<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span><span class="token string">'Ertsul'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'All finished!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AsyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Promise()方式使用：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> AsyncParallelHook <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'tapable'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AsyncHook</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">arch</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncParallelHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>arch<span class="token punctuation">.</span><span class="token function">tapPromise</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>arch<span class="token punctuation">.</span><span class="token function">tapPromise</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>arch<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token string">'Ertsul'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hook all finished!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AsyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="synchook-同步钩子"><a href="#synchook-同步钩子" class="header-anchor">#</a> Synchook 同步钩子</h4> <p>实现：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Synchook</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// args =&gt; ['Synchook']</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tasks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 注册事件数组</span>
  <span class="token punctuation">}</span>
  <span class="token function">tap</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> task</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//  注册事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">call</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 发布事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">task</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">task</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> hook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Synchook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Synchook'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
hook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">hook</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'Ertsul'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="data:image/png;base64,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" alt="image.png"></p> <h4 id="syncbailhook-同步熔断钩子"><a href="#syncbailhook-同步熔断钩子" class="header-anchor">#</a> SyncBailHook 同步熔断钩子</h4> <p>Synchook 同步钩子在执行每个函数的时候会有一个返回值，undefined：执行成功，继续执行下一个函数，!= undefined：熔断执行，不执行下一个函数。</p> <p>实现：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Syncbailhook 同步熔断执行，会判断返回是否等于 undefined 来执行下一个函数</span>
<span class="token keyword">class</span> <span class="token class-name">Syncbailhook</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tasks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">tap</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> task</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">call</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> ret <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token comment">// 当前函数的返回值</span>
    <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 当前任务数组的索引</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
      ret <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>tasks<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>ret <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> index <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>tasks<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> hook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Syncbailhook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Syncbailhook'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
hook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">hook</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'Ertsul'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="data:image/png;base64,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" alt="image.png"></p> <h4 id="syncwaterfallhook-同步瀑布钩子"><a href="#syncwaterfallhook-同步瀑布钩子" class="header-anchor">#</a> SyncWaterfallHook 同步瀑布钩子</h4> <p>Syncwaterfallhook 同步瀑布执行，各个函数之间存在关系，上一个函数的执行返回结果在当前函数的输入。</p> <p>实现：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * Syncwaterfallhook 同步瀑布执行，各个函数之间存在关系
 * 上一个函数的执行返回结果在当前函数的输入
 */</span>
<span class="token keyword">class</span> <span class="token class-name">Syncwaterfallhook</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tasks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">tap</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> task</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">call</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">[</span>first<span class="token punctuation">,</span> <span class="token operator">...</span>others<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>tasks<span class="token punctuation">;</span>
    <span class="token keyword">let</span> ret <span class="token operator">=</span> <span class="token function">first</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    others<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prev<span class="token punctuation">,</span> current</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">current</span><span class="token punctuation">(</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> hook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Syncwaterfallhook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Syncwaterfallhook'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token string">'vue learnt'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
hook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">hook</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'Ertsul'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="data:image/png;base64,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" alt="image.png"></p> <h4 id="syncloophook-同步循环钩子"><a href="#syncloophook-同步循环钩子" class="header-anchor">#</a> SyncLoopHook 同步循环钩子</h4> <p>同步循环钩子回让某个函数执行一定的次数。</p> <p>实现：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Tapable Syncloophook 同步循环钩子</span>
<span class="token keyword">class</span> <span class="token class-name">Syncloophook</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// args =&gt; ['Synchook']</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tasks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 注册事件数组</span>
  <span class="token punctuation">}</span>
  <span class="token function">tap</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> task</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//  注册事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">call</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 发布事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">task</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> ret <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
      <span class="token keyword">do</span> <span class="token punctuation">{</span>
        ret <span class="token operator">=</span> <span class="token function">task</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>ret <span class="token operator">!=</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> hook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Syncloophook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Syncloophook'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> total <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
hook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">++</span>index <span class="token operator">===</span> total <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token operator">:</span> <span class="token string">'continue'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
hook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">hook</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'Ertsul'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="data:image/png;base64,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" alt="image.png"></p> <h4 id="asyncparallelhook-异步并发钩子-回调函数方式"><a href="#asyncparallelhook-异步并发钩子-回调函数方式" class="header-anchor">#</a> AsyncParallelHook 异步并发钩子 回调函数方式</h4> <p>实现：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Tapable Asynchook 异步钩子</span>
<span class="token keyword">class</span> <span class="token class-name">asyncparallelhook</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// args =&gt; ['Synchook']</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tasks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 注册事件数组</span>
  <span class="token punctuation">}</span>
  <span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> task</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//  注册事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">callAsync</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 发布事件</span>
    <span class="token keyword">let</span> finalCallback <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">done</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      index<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>tasks<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">finalCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">task</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">task</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">,</span> done<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> hook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">asyncparallelhook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'asyncparallelhook'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hook<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cb <span class="token operator">&amp;&amp;</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
hook<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cb <span class="token operator">&amp;&amp;</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
hook<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span><span class="token string">'Ertsul'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'All hook finished!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="asyncparallelhook-异步并发钩子-promise方式"><a href="#asyncparallelhook-异步并发钩子-promise方式" class="header-anchor">#</a> AsyncParallelHook 异步并发钩子 Promise方式</h4> <p>实现：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Tapable Asynchook 异步钩子</span>
<span class="token keyword">class</span> <span class="token class-name">asyncparallelhook</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// args =&gt; ['Synchook']</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tasks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 注册事件数组</span>
  <span class="token punctuation">}</span>
  <span class="token function">tapPromise</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> task</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//  注册事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">promise</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 发布事件</span>
    <span class="token keyword">let</span> tasks <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">task</span> <span class="token operator">=&gt;</span> <span class="token function">task</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> hook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">asyncparallelhook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'asyncparallelhook'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hook<span class="token punctuation">.</span><span class="token function">tapPromise</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
hook<span class="token punctuation">.</span><span class="token function">tapPromise</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
hook<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token string">'Ertsul'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'All hooks finished!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="asyncserieshook-异步串行钩子"><a href="#asyncserieshook-异步串行钩子" class="header-anchor">#</a> AsyncSeriesHook 异步串行钩子</h4> <h4 id="asyncwaterfallhook-异步瀑布流钩子"><a href="#asyncwaterfallhook-异步瀑布流钩子" class="header-anchor">#</a> AsyncWaterfallHook 异步瀑布流钩子</h4></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/blog/webpack/搭建组件库.html">
        搭建组件库
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/blog/assets/js/app.a0842275.js" defer></script><script src="/blog/assets/js/2.9a122aa2.js" defer></script><script src="/blog/assets/js/6.41dc5a45.js" defer></script>
  </body>
</html>
