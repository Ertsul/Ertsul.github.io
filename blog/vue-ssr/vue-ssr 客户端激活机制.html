<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ertsul&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="shortcut icon" type="image/png" sizes="32x32" href="https://s2.loli.net/2022/04/02/uCOBfH6XgGUEdPt.png">
    <link rel="shortcut icon" type="image/png" sizes="16x16" href="https://s2.loli.net/2022/04/02/uCOBfH6XgGUEdPt.png">
    <style type="text/css">.logo {height: 2.2rem!important; width: 2.2rem!important;border-radius: 100%;margin-right: 0.8rem;vertical-align: top;}</style>
    <meta name="description" content="è®°å½•æ‰€å­¦">
    
    <link rel="preload" href="/blog/assets/css/0.styles.214aaa3c.css" as="style"><link rel="preload" href="/blog/assets/js/app.aa26872a.js" as="script"><link rel="preload" href="/blog/assets/js/2.9a122aa2.js" as="script"><link rel="preload" href="/blog/assets/js/59.af470f36.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.c6459277.js"><link rel="prefetch" href="/blog/assets/js/11.dab37ad7.js"><link rel="prefetch" href="/blog/assets/js/12.224310fc.js"><link rel="prefetch" href="/blog/assets/js/13.0f66f160.js"><link rel="prefetch" href="/blog/assets/js/14.b3199019.js"><link rel="prefetch" href="/blog/assets/js/15.5e07c399.js"><link rel="prefetch" href="/blog/assets/js/16.7cfea898.js"><link rel="prefetch" href="/blog/assets/js/17.4f7bd15c.js"><link rel="prefetch" href="/blog/assets/js/18.5043e767.js"><link rel="prefetch" href="/blog/assets/js/19.d0b02c4f.js"><link rel="prefetch" href="/blog/assets/js/20.3d0bb1e8.js"><link rel="prefetch" href="/blog/assets/js/21.459236dc.js"><link rel="prefetch" href="/blog/assets/js/22.a76cd03c.js"><link rel="prefetch" href="/blog/assets/js/23.d5a2fb7b.js"><link rel="prefetch" href="/blog/assets/js/24.0c91db79.js"><link rel="prefetch" href="/blog/assets/js/25.c9fa77f3.js"><link rel="prefetch" href="/blog/assets/js/26.4f8f8ad0.js"><link rel="prefetch" href="/blog/assets/js/27.2c78cdfa.js"><link rel="prefetch" href="/blog/assets/js/28.f04bb25b.js"><link rel="prefetch" href="/blog/assets/js/29.adf164b1.js"><link rel="prefetch" href="/blog/assets/js/3.2f4eba70.js"><link rel="prefetch" href="/blog/assets/js/30.366e6853.js"><link rel="prefetch" href="/blog/assets/js/31.1ec7fe1d.js"><link rel="prefetch" href="/blog/assets/js/32.1d9c8421.js"><link rel="prefetch" href="/blog/assets/js/33.fe4440ff.js"><link rel="prefetch" href="/blog/assets/js/34.ce2d415a.js"><link rel="prefetch" href="/blog/assets/js/35.49a653fd.js"><link rel="prefetch" href="/blog/assets/js/36.b60f5904.js"><link rel="prefetch" href="/blog/assets/js/37.38349e7b.js"><link rel="prefetch" href="/blog/assets/js/38.a9ea3219.js"><link rel="prefetch" href="/blog/assets/js/39.012c1347.js"><link rel="prefetch" href="/blog/assets/js/4.3710861a.js"><link rel="prefetch" href="/blog/assets/js/40.c5ab5215.js"><link rel="prefetch" href="/blog/assets/js/41.30b60600.js"><link rel="prefetch" href="/blog/assets/js/42.e05442a8.js"><link rel="prefetch" href="/blog/assets/js/43.bcbb80ec.js"><link rel="prefetch" href="/blog/assets/js/44.81414c7e.js"><link rel="prefetch" href="/blog/assets/js/45.a31b7092.js"><link rel="prefetch" href="/blog/assets/js/46.84eb4b02.js"><link rel="prefetch" href="/blog/assets/js/47.1d498896.js"><link rel="prefetch" href="/blog/assets/js/48.14d02496.js"><link rel="prefetch" href="/blog/assets/js/49.e0aea9fc.js"><link rel="prefetch" href="/blog/assets/js/5.880e79fc.js"><link rel="prefetch" href="/blog/assets/js/50.de1c1a08.js"><link rel="prefetch" href="/blog/assets/js/51.c4a8b548.js"><link rel="prefetch" href="/blog/assets/js/52.cbaea585.js"><link rel="prefetch" href="/blog/assets/js/53.d513c007.js"><link rel="prefetch" href="/blog/assets/js/54.5cbe1345.js"><link rel="prefetch" href="/blog/assets/js/55.c1f97600.js"><link rel="prefetch" href="/blog/assets/js/56.0c1665fc.js"><link rel="prefetch" href="/blog/assets/js/57.55a7ca82.js"><link rel="prefetch" href="/blog/assets/js/58.2ce372c4.js"><link rel="prefetch" href="/blog/assets/js/6.a04da7ab.js"><link rel="prefetch" href="/blog/assets/js/60.ce0d4fa0.js"><link rel="prefetch" href="/blog/assets/js/61.af0aa3a2.js"><link rel="prefetch" href="/blog/assets/js/62.4a6635b8.js"><link rel="prefetch" href="/blog/assets/js/63.f8d9b8fb.js"><link rel="prefetch" href="/blog/assets/js/64.89c82719.js"><link rel="prefetch" href="/blog/assets/js/65.3a168359.js"><link rel="prefetch" href="/blog/assets/js/66.dfd15524.js"><link rel="prefetch" href="/blog/assets/js/67.7069ed0e.js"><link rel="prefetch" href="/blog/assets/js/7.d10e2fd6.js"><link rel="prefetch" href="/blog/assets/js/8.4ed71331.js"><link rel="prefetch" href="/blog/assets/js/9.a56c335b.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.214aaa3c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="https://avatars.githubusercontent.com/u/17139306?v=4" alt="Ertsul's Blog" class="logo"> <span class="site-name can-hide">Ertsul's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="åˆ†ç±»" class="dropdown-title"><span class="title">åˆ†ç±»</span> <span class="arrow down"></span></button> <button type="button" aria-label="åˆ†ç±»" class="mobile-dropdown-title"><span class="title">åˆ†ç±»</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/vue-source-code/Vue æºç é˜…è¯»1 å¼•å…¥vueæ¨¡å—/" class="nav-link">
  Vue æºç 
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue3-source-code/vue3 å“åº”å¼åŸç†/" class="nav-link">
  vue3 æºç 
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue-router/vue-router æºç é˜…è¯»ï¼ˆä¸€ï¼‰/" class="nav-link">
  vue-router æºç 
</a></li><li class="dropdown-item"><!----> <a href="/blog/vuex/vuex æºç é˜…è¯»/" class="nav-link">
  vuex æºç é˜…è¯»
</a></li><li class="dropdown-item"><!----> <a href="/blog/question-source-code/vue-template-compiler template ç¼–è¯‘æµç¨‹/" class="nav-link">
  å¸¦ç€é—®é¢˜çœ‹æºç 
</a></li><li class="dropdown-item"><!----> <a href="/blog/router/å‰ç«¯è·¯ç”±/" class="nav-link">
  å‰ç«¯è·¯ç”±
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue/svg sprite/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue-ssr/vue-srr é¡¹ç›®æ­å»º/" class="nav-link">
  Vue SSR
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/EC AO VO Scope Chain/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/blog/flutter/flutter çŸ¥è¯†ç‚¹è®°å½•/" class="nav-link">
  Flutter
</a></li><li class="dropdown-item"><!----> <a href="/blog/webpack/webpackå­¦ä¹ ç¬”è®°/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/blog/low-code-platform/å¯è§†åŒ–æ­å»ºå¹³å°ï¼ˆä¸€ï¼‰- æµç¨‹/" class="nav-link">
  å¯è§†åŒ–æ­å»ºå¹³å°
</a></li><li class="dropdown-item"><!----> <a href="/blog/algorithm/å¹¿åº¦ä¼˜å…ˆæœç´¢ BFS å’Œæ·±åº¦ä¼˜å…ˆæœç´¢ DFS/" class="nav-link">
  ç®—æ³•
</a></li><li class="dropdown-item"><!----> <a href="/blog/css/3Dç«‹ä½“éª°å­/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/blog/git/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/blog/web-safe/web-safe/" class="nav-link">
  Web Safe
</a></li><li class="dropdown-item"><!----> <a href="/blog/minapp/å°ç¨‹åºå·¥ç¨‹åŒ–/" class="nav-link">
  å°ç¨‹åº
</a></li><li class="dropdown-item"><!----> <a href="/blog/others/v8 å¼•æ“åŠå…¶ GC æœºåˆ¶/" class="nav-link">
  å…¶ä»–
</a></li></ul></div></div><div class="nav-item"><a href="/blog/" class="nav-link">
  ä¸»é¡µ
</a></div> <a href="https://github.com/Ertsul/" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="åˆ†ç±»" class="dropdown-title"><span class="title">åˆ†ç±»</span> <span class="arrow down"></span></button> <button type="button" aria-label="åˆ†ç±»" class="mobile-dropdown-title"><span class="title">åˆ†ç±»</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/vue-source-code/Vue æºç é˜…è¯»1 å¼•å…¥vueæ¨¡å—/" class="nav-link">
  Vue æºç 
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue3-source-code/vue3 å“åº”å¼åŸç†/" class="nav-link">
  vue3 æºç 
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue-router/vue-router æºç é˜…è¯»ï¼ˆä¸€ï¼‰/" class="nav-link">
  vue-router æºç 
</a></li><li class="dropdown-item"><!----> <a href="/blog/vuex/vuex æºç é˜…è¯»/" class="nav-link">
  vuex æºç é˜…è¯»
</a></li><li class="dropdown-item"><!----> <a href="/blog/question-source-code/vue-template-compiler template ç¼–è¯‘æµç¨‹/" class="nav-link">
  å¸¦ç€é—®é¢˜çœ‹æºç 
</a></li><li class="dropdown-item"><!----> <a href="/blog/router/å‰ç«¯è·¯ç”±/" class="nav-link">
  å‰ç«¯è·¯ç”±
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue/svg sprite/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue-ssr/vue-srr é¡¹ç›®æ­å»º/" class="nav-link">
  Vue SSR
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/EC AO VO Scope Chain/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/blog/flutter/flutter çŸ¥è¯†ç‚¹è®°å½•/" class="nav-link">
  Flutter
</a></li><li class="dropdown-item"><!----> <a href="/blog/webpack/webpackå­¦ä¹ ç¬”è®°/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/blog/low-code-platform/å¯è§†åŒ–æ­å»ºå¹³å°ï¼ˆä¸€ï¼‰- æµç¨‹/" class="nav-link">
  å¯è§†åŒ–æ­å»ºå¹³å°
</a></li><li class="dropdown-item"><!----> <a href="/blog/algorithm/å¹¿åº¦ä¼˜å…ˆæœç´¢ BFS å’Œæ·±åº¦ä¼˜å…ˆæœç´¢ DFS/" class="nav-link">
  ç®—æ³•
</a></li><li class="dropdown-item"><!----> <a href="/blog/css/3Dç«‹ä½“éª°å­/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/blog/git/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/blog/web-safe/web-safe/" class="nav-link">
  Web Safe
</a></li><li class="dropdown-item"><!----> <a href="/blog/minapp/å°ç¨‹åºå·¥ç¨‹åŒ–/" class="nav-link">
  å°ç¨‹åº
</a></li><li class="dropdown-item"><!----> <a href="/blog/others/v8 å¼•æ“åŠå…¶ GC æœºåˆ¶/" class="nav-link">
  å…¶ä»–
</a></li></ul></div></div><div class="nav-item"><a href="/blog/" class="nav-link">
  ä¸»é¡µ
</a></div> <a href="https://github.com/Ertsul/" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/blog/vue-ssr/vue-srr é¡¹ç›®æ­å»º.html" class="sidebar-link">vue-srr é¡¹ç›®æ­å»º</a></li><li><a href="/blog/vue-ssr/vue-ssr å®¢æˆ·ç«¯æ¿€æ´»æœºåˆ¶.html" class="active sidebar-link">vue-ssr å®¢æˆ·ç«¯æ¿€æ´»æœºåˆ¶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/vue-ssr/vue-ssr å®¢æˆ·ç«¯æ¿€æ´»æœºåˆ¶.html#hydrate-å‡½æ•°" class="sidebar-link">hydrate å‡½æ•°</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/vue-ssr/vue-ssr å®¢æˆ·ç«¯æ¿€æ´»æœºåˆ¶.html#assertnodematch-å‡½æ•°" class="sidebar-link">assertNodeMatch å‡½æ•°</a></li><li class="sidebar-sub-header"><a href="/blog/vue-ssr/vue-ssr å®¢æˆ·ç«¯æ¿€æ´»æœºåˆ¶.html#isrenderedmodule-map" class="sidebar-link">isRenderedModule Map</a></li><li class="sidebar-sub-header"><a href="/blog/vue-ssr/vue-ssr å®¢æˆ·ç«¯æ¿€æ´»æœºåˆ¶.html#invokecreatehooks-å‡½æ•°" class="sidebar-link">invokeCreateHooks å‡½æ•°</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/vue-ssr/vue-ssr å®¢æˆ·ç«¯æ¿€æ´»æœºåˆ¶.html#invokeinserthook-å‡½æ•°" class="sidebar-link">invokeInsertHook å‡½æ•°</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p><a href="https://ssr.vuejs.org/zh/guide/hydration.html" target="_blank" rel="noopener noreferrer">æ–‡æ¡£ğŸ”—ğŸ‘‰<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>æ‰€è°“å®¢æˆ·ç«¯æ¿€æ´»ï¼ŒæŒ‡çš„æ˜¯ Vue åœ¨æµè§ˆå™¨ç«¯æ¥ç®¡ç”±æœåŠ¡ç«¯å‘é€çš„é™æ€ HTMLï¼Œä½¿å…¶å˜ä¸ºç”± Vue ç®¡ç†çš„åŠ¨æ€ DOM çš„è¿‡ç¨‹ã€‚</p></blockquote> <p>ç”±äºæœåŠ¡ç«¯å·²ç»æ¸²æŸ“å¥½äº† HTMLï¼Œæ‰€ä»¥åœ¨å®¢æˆ·ç«¯ä¸éœ€è¦é‡æ–°åˆ›å»ºå…¨éƒ¨çš„ DOM å…ƒç´ ã€‚å®¢æˆ·ç«¯æ¿€æ´»å°±æ˜¯æ¿€æ´»æœåŠ¡ç«¯è¿”å›çš„ HTMLï¼Œä½¿ä¹‹æˆä¸ºå“åº”å¼ã€‚</p> <p>æœ‰ä¸¤ç§æ–¹å¼æ ‡è®° HTML æ˜¯æœåŠ¡ç«¯æ”¾è¿”å›ï¼š</p> <ul><li><code>&lt;div id=&quot;app&quot; data-server-rendered=&quot;true&quot; /&gt;</code></li> <li><code>app.$mount(&quot;#app&quot;, true)</code></li></ul> <p>é€šè¿‡ä¸Šé¢æ–¹å¼å¯è·å–å½“å‰ vnode æ˜¯å¦ä¸ºæœåŠ¡ç«¯æ¸²æŸ“ï¼Œåœ¨å¯¹æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„ vnode è¿›è¡Œ patch çš„æ—¶å€™ï¼Œä¼šè¿›ä¸€æ­¥åˆ¤æ–­ oldVnode æ˜¯å¦ä¸ºçœŸå®çš„ DOM å…ƒç´ èŠ‚ç‚¹ï¼Œæ˜¯çš„è¯åˆ™ï¼š</p> <ul><li>è°ƒç”¨ hydrate å¯¹ä¸¤ç«¯æ•°æ®è¿›è¡Œæ··åˆã€‚</li> <li>è°ƒç”¨ invokeCreateHooksï¼Œæ¿€æ´»å®¢æˆ·ç«¯æ•°æ®ï¼Œå¦‚ï¼šç»‘å®šæ ‡ç­¾çš„ç»‘å®šäº‹ä»¶ç­‰ã€‚</li> <li>è°ƒç”¨ invokeInsertHooksï¼Œè°ƒç”¨ç»„ä»¶æ’å…¥é’©å­ã€‚</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createPatchFunction</span> <span class="token punctuation">(</span><span class="token parameter">backend</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">patch</span><span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> hydrating<span class="token punctuation">,</span> removeOnly</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">var</span> isRealElement <span class="token operator">=</span> <span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>nodeType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isRealElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// åˆ¤æ–­æ˜¯å¦ä¸ºæœåŠ¡ç«¯æ¸²æŸ“</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> oldVnode<span class="token punctuation">.</span><span class="token function">hasAttribute</span><span class="token punctuation">(</span><span class="token constant">SSR_ATTR</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        oldVnode<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token constant">SSR_ATTR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hydrating <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>hydrating<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æœåŠ¡ç«¯æ¸²æŸ“å®¢æˆ·ç«¯æ¿€æ´»é€»è¾‘</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hydrate</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">invokeInsertHook</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> oldVnode
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">warn</span><span class="token punctuation">(</span>
            <span class="token string">'The client-side rendered virtual DOM tree is not matching '</span> <span class="token operator">+</span>
            <span class="token string">'server-rendered content. This is likely caused by incorrect '</span> <span class="token operator">+</span>
            <span class="token string">'HTML markup, for example nesting block-level elements inside '</span> <span class="token operator">+</span>
            <span class="token string">'&lt;p&gt;, or missing &lt;tbody&gt;. Bailing hydration and performing '</span> <span class="token operator">+</span>
            <span class="token string">'full client-side render.'</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="hydrate-å‡½æ•°"><a href="#hydrate-å‡½æ•°" class="header-anchor">#</a> hydrate å‡½æ•°</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">hydrate</span><span class="token punctuation">(</span><span class="token parameter">elm<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> inVPre</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> i<span class="token punctuation">;</span>
  <span class="token keyword">var</span> tag <span class="token operator">=</span> vnode<span class="token punctuation">.</span>tag<span class="token punctuation">;</span>
  <span class="token keyword">var</span> data <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token keyword">var</span> children <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
  inVPre <span class="token operator">=</span> inVPre <span class="token operator">||</span> <span class="token punctuation">(</span>data <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">.</span>pre<span class="token punctuation">)</span><span class="token punctuation">;</span>
  vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> elm<span class="token punctuation">;</span>

  <span class="token comment">// åˆ¤æ–­æ˜¯å¦ä¸ºæ³¨é‡Šæˆ–è€…å¼‚æ­¥ç»„ä»¶</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>isComment<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>asyncFactory<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vnode<span class="token punctuation">.</span>isAsyncPlaceholder <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// æ£€éªŒ node èŠ‚ç‚¹æ˜¯å¦åŒ¹é…</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">assertNodeMatch</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> inVPre<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœæ˜¯å­ç»„ä»¶ï¼Œåˆ™åˆå§‹åŒ–å­ç»„ä»¶</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> data<span class="token punctuation">.</span>hook<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>init<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">i</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment">/* hydrating */</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> vnode<span class="token punctuation">.</span>componentInstance<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// child component. it should have hydrated its own tree.</span>
      <span class="token function">initComponent</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// æ ‡ç­¾èŠ‚ç‚¹</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// empty element, allow client to pick up and populate children</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>elm<span class="token punctuation">.</span><span class="token function">hasChildNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å®é™…èŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œå®¢æˆ·ç«¯çš„èŠ‚ç‚¹æœ‰å­èŠ‚ç‚¹ï¼Œåˆ™åˆ›å»ºå­èŠ‚ç‚¹å¹¶æ·»åŠ åˆ°æ—§èŠ‚ç‚¹ä¸­</span>
        <span class="token function">createChildren</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> children<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// v-html and domProps: innerHTML</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>domProps<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// v-html å’Œ domPropsï¼Œåˆ™åˆ¤æ–­ innerHTML æ˜¯å¦ç›¸åŒ</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">!==</span> elm<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">/* istanbul ignore if */</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> console <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span>
                <span class="token operator">!</span>hydrationBailed
               <span class="token punctuation">)</span> <span class="token punctuation">{</span>
              hydrationBailed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
              console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'Parent: '</span><span class="token punctuation">,</span> elm<span class="token punctuation">)</span><span class="token punctuation">;</span>
              console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'server innerHTML: '</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
              console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'client innerHTML: '</span><span class="token punctuation">,</span> elm<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// è¿­ä»£å¹¶æ¯”è¾ƒä¸¤ç«¯å­åˆ—è¡¨</span>
          <span class="token keyword">var</span> childrenMatch <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          <span class="token keyword">var</span> childNode <span class="token operator">=</span> elm<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span> <span class="token comment">// è·å–æ—§èŠ‚ç‚¹åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i$1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i$1 <span class="token operator">&lt;</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i$1<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// éå†æ–° vnode åˆ—è¡¨</span>

            <span class="token comment">// å¦‚æœ childNode ä¸å­˜åœ¨ï¼Œè¯´æ˜å®é™…èŠ‚ç‚¹åˆ—è¡¨çš„é•¿åº¦å’Œæ–° vnode åˆ—è¡¨ä¸ç›¸ç­‰ï¼Œåˆ™æ··åˆå¤±è´¥</span>
            <span class="token comment">// å¦‚æœæœ‰å­èŠ‚ç‚¹ï¼Œåˆ™é€’å½’è°ƒç”¨ hydrate è¿›è¡Œæ··åˆ</span>
            <span class="token comment">// æ··åˆå¤±è´¥ç›´æ¥è·³å‡ºå¾ªç¯</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>childNode <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">hydrate</span><span class="token punctuation">(</span>childNode<span class="token punctuation">,</span> children<span class="token punctuation">[</span>i$1<span class="token punctuation">]</span><span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> inVPre<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              childrenMatch <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
              <span class="token keyword">break</span>
            <span class="token punctuation">}</span>
            childNode <span class="token operator">=</span> childNode<span class="token punctuation">.</span>nextSibling<span class="token punctuation">;</span> <span class="token comment">// è·å–æ—§ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹</span>
          <span class="token punctuation">}</span>
          <span class="token comment">// childNode ä¸ä¸ºç©ºï¼Œè¯´æ˜å®é™…å­èŠ‚ç‚¹åˆ—è¡¨æ¯”æ–° vnode åˆ—è¡¨å¤šï¼Œæ··åˆå¤±è´¥</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>childrenMatch <span class="token operator">||</span> childNode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">/* istanbul ignore if */</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> console <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span>
                <span class="token operator">!</span>hydrationBailed
               <span class="token punctuation">)</span> <span class="token punctuation">{</span>
              hydrationBailed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
              console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'Parent: '</span><span class="token punctuation">,</span> elm<span class="token punctuation">)</span><span class="token punctuation">;</span>
              console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'Mismatching childNodes vs. VNodes: '</span><span class="token punctuation">,</span> elm<span class="token punctuation">.</span>childNodes<span class="token punctuation">,</span> children<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è·å–å½“å‰ vnode çš„ç»‘å®šä¿¡æ¯ï¼Œå¦‚ï¼šäº‹ä»¶ç­‰</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> fullInvoke <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isRenderedModule</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// åˆ¤æ–­æ˜¯å¦å±æ€§æ˜¯å¦åœ¨å®¢æˆ·ç«¯å·²åˆå§‹åŒ–</span>
          fullInvoke <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          <span class="token function">invokeCreateHooks</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç»‘å®šäº‹ä»¶ç­‰</span>
          <span class="token keyword">break</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fullInvoke <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ç¡®ä¿æ”¶é›†æ·±å±‚ç»‘å®šçš„ deps ä»¥è¿›è¡Œæ›´æ–°</span>
        <span class="token function">traverse</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>elm<span class="token punctuation">.</span>data <span class="token operator">!==</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ–‡æœ¬èŠ‚ç‚¹ä¸”å®é™…æ–‡æœ¬ä¸æ–° vnode çš„æ–‡æœ¬å†…å®¹ä¸åŒï¼Œåˆ™ç›´æ¥ç”¨æ›´æ–°æ–‡æœ¬å†…å®¹</span>
    elm<span class="token punctuation">.</span>data <span class="token operator">=</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å‡½æ•°æ‰§è¡Œé€»è¾‘ä¸ºï¼š</p> <ol><li>é¦–å…ˆåˆ¤æ–­æ˜¯å¦ä¸ºæ³¨é‡Šæˆ–è€…å¼‚æ­¥ç»„ä»¶ï¼Œæ˜¯çš„è¯ç›´æ¥è¿”å› trueï¼Œè¯´æ˜æ··åˆæˆåŠŸã€‚</li> <li>æ¥ç€è°ƒç”¨ assertNodeMatch å‡½æ•°æ ¡éªŒå®é™… DOM èŠ‚ç‚¹ä¸æ–° vnode çš„ node èŠ‚ç‚¹æ˜¯å¦åŒ¹é…ï¼Œå¤±è´¥çš„è¯è¿”å› falseï¼Œè¯´æ˜æ··åˆå¤±è´¥ã€‚</li> <li>æ¥ç€åˆ¤æ–­æ˜¯å¦æ˜¯å­ç»„ä»¶ï¼Œå¦‚æœæ˜¯å­ç»„ä»¶ï¼Œåˆ™è°ƒç”¨ initComponent åˆå§‹åŒ–å­ç»„ä»¶ã€‚</li> <li>å¦‚æœæ˜¯æ ‡ç­¾èŠ‚ç‚¹ï¼Œå®¢æˆ·ç«¯çš„èŠ‚ç‚¹ï¼ˆæ–° vnodeï¼‰æœ‰å­èŠ‚ç‚¹ï¼Œä½†å®é™…èŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œåˆ™åˆ›å»ºå­èŠ‚ç‚¹å¹¶æ·»åŠ åˆ°æ—§èŠ‚ç‚¹ä¸­ã€‚</li> <li>å¦‚æœæ˜¯æ ‡ç­¾èŠ‚ç‚¹ï¼Œå®¢æˆ·ç«¯çš„èŠ‚ç‚¹ï¼ˆæ–° vnodeï¼‰å’Œå®é™…èŠ‚ç‚¹éƒ½æœ‰å­èŠ‚ç‚¹ï¼š
<ol><li>å¦‚æœæ˜¯ v-html å’Œ domPropsï¼ˆrender å‡½æ•°ä¸­æœ‰è¯¥å±æ€§ï¼‰ çš„è¯ï¼Œåˆ™åˆ¤æ–­ innerHTML æ˜¯å¦ç›¸åŒï¼Œä¸ç›¸åŒåˆ™è¿”å› false;</li> <li>è¿­ä»£å¹¶æ¯”è¾ƒä¸¤ç«¯å­åˆ—è¡¨ã€‚éå†é€»è¾‘ä¸ºï¼šéå†æ–° vnode åˆ—è¡¨ï¼Œè·å–å®é™…èŠ‚ç‚¹åˆ—è¡¨çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ childNodeã€‚å¦‚æœchildNode ä¸å­˜åœ¨ï¼Œè¯´æ˜å®é™…èŠ‚ç‚¹åˆ—è¡¨çš„é•¿åº¦å’Œæ–° vnode åˆ—è¡¨ä¸ç›¸ç­‰ï¼Œåˆ™æ··åˆå¤±è´¥ï¼›å¦‚æœæœ‰å­èŠ‚ç‚¹ï¼Œåˆ™é€’å½’è°ƒç”¨ hydrate è¿›è¡Œæ··åˆã€‚å¾ªç¯éå†ç»“æŸåï¼Œå¦‚æœ childNode ä¸ä¸ºç©ºï¼Œè¯´æ˜å®é™…å­èŠ‚ç‚¹åˆ—è¡¨æ¯”æ–° vnode åˆ—è¡¨å¤šï¼Œæ··åˆå¤±è´¥ã€‚</li> <li>åœ¨å¤„ç†å®Œä¸Šé¢ä¸¤ä¸ªé€»è¾‘ä¹‹åï¼Œæ ‡ç­¾èŠ‚ç‚¹è¿˜ä¼šé€šè¿‡ vnode.data è·å–å½“å‰ vnode çš„ç»‘å®šä¿¡æ¯ï¼Œç„¶åé€šè¿‡ isRenderedModule åˆ¤æ–­èŠ‚ç‚¹å±æ€§æ˜¯å¦åœ¨æœåŠ¡ç«¯å·²ç»å¤„ç†è¿‡ï¼Œå¦‚æœæœªå¤„ç†è¿‡ï¼Œå¦‚ï¼šäº‹ä»¶ç­‰ï¼Œåˆ™è°ƒç”¨ invokeCreateHooks è¿›è¡Œå¤„ç†ã€‚</li></ol></li> <li>å¦‚æœæ˜¯æ–‡æœ¬èŠ‚ç‚¹ä¸”å®é™…çš„èŠ‚ç‚¹å†…å®¹ä¸æ–° vnode æ–‡æœ¬å†…å®¹ä¸ç›¸åŒï¼Œåˆ™ç›´æ¥ç”¨æ›´æ–°æ–‡æœ¬å†…å®¹ã€‚</li></ol> <h3 id="assertnodematch-å‡½æ•°"><a href="#assertnodematch-å‡½æ•°" class="header-anchor">#</a> assertNodeMatch å‡½æ•°</h3> <p>è¯¥å‡½æ•°ç”¨äºæ ¡éªŒå®é™… DOM èŠ‚ç‚¹ä¸æ–° vnode çš„ node èŠ‚ç‚¹æ˜¯å¦åŒ¹é…ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">assertNodeMatch</span> <span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> inVPre</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>tag<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> vnode<span class="token punctuation">.</span>tag<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'vue-component'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token punctuation">(</span>
      <span class="token operator">!</span><span class="token function">isUnknownElement$$1</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> inVPre<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
      vnode<span class="token punctuation">.</span>tag<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>tagName <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span>tagName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> node<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> <span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>isComment <span class="token operator">?</span> <span class="token number">8</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="isrenderedmodule-map"><a href="#isrenderedmodule-map" class="header-anchor">#</a> isRenderedModule Map</h3> <p>ç”¨äºåˆ¤æ–­æ ‡ç­¾å±æ€§æ˜¯å¦åœ¨å®¢æˆ·ç«¯å·²ç»å¤„ç†è¿‡ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> isRenderedModule <span class="token operator">=</span> <span class="token function">makeMap</span><span class="token punctuation">(</span><span class="token string">'attrs,class,staticClass,staticStyle,key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">makeMap</span> <span class="token punctuation">(</span>
  <span class="token parameter">str<span class="token punctuation">,</span>
  expectsLowerCase</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> map <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> list <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> list<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    map<span class="token punctuation">[</span>list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> expectsLowerCase
    <span class="token operator">?</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> map<span class="token punctuation">[</span>val<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> map<span class="token punctuation">[</span>val<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="invokecreatehooks-å‡½æ•°"><a href="#invokecreatehooks-å‡½æ•°" class="header-anchor">#</a> invokeCreateHooks å‡½æ•°</h3> <p>ç”¨äºå¤„ç†æœªåœ¨æœåŠ¡ç«¯å¤„ç†è¿‡çš„æ ‡ç­¾å±æ€§ï¼Œå¦‚ï¼šäº‹ä»¶ç»‘å®šç­‰ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">invokeCreateHooks</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> insertedVnodeQueue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i$1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i$1 <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>create<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i$1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cbs<span class="token punctuation">.</span>create<span class="token punctuation">[</span>i$1<span class="token punctuation">]</span><span class="token punctuation">(</span>emptyNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  i <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>hook<span class="token punctuation">;</span> <span class="token comment">// Reuse variable</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>create<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> i<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>emptyNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>insert<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> insertedVnodeQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å…¶ä¸­ï¼Œcbs åœ¨åˆå§‹åŒ– patch å‡½æ•°æ—¶ï¼Œä¼šæ”¶é›†æ‰€æœ‰çš„äº‹ä»¶ hook åˆ° cbs ä¸­ï¼Œå¦‚ä¸‹æ ¼å¼ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createPatchFunction</span> <span class="token punctuation">(</span><span class="token parameter">backend</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">var</span> i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>
 <span class="token keyword">var</span> cbs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

 <span class="token keyword">var</span> modules <span class="token operator">=</span> backend<span class="token punctuation">.</span>modules<span class="token punctuation">;</span>
 <span class="token keyword">var</span> nodeOps <span class="token operator">=</span> backend<span class="token punctuation">.</span>nodeOps<span class="token punctuation">;</span>
 
   <span class="token comment">// æ”¶é›†æ‰€æœ‰çš„äº‹ä»¶ hook åˆ° cbs ä¸­</span>
 <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> hooks<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   cbs<span class="token punctuation">[</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> modules<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>modules<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       cbs<span class="token punctuation">[</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>modules<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
<span class="token comment">// cbs æ•°æ®å†…å®¹</span>
cbs <span class="token operator">=</span> <span class="token punctuation">{</span>
 <span class="token literal-property property">activate</span><span class="token operator">:</span> <span class="token punctuation">[</span>Æ’<span class="token punctuation">]</span>
 <span class="token literal-property property">create</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>
   <span class="token function">updateAttrs</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">,</span>
   <span class="token function">updateClass</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">,</span>
   <span class="token function">updateDOMListeners</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">,</span>
   <span class="token function">updateDOMProps</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">,</span>
   <span class="token function">updateStyle</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">,</span>
   <span class="token function">_enter</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">,</span>
   <span class="token function">create</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">,</span>
   <span class="token function">updateDirectives</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
 <span class="token punctuation">]</span><span class="token punctuation">,</span>
 <span class="token literal-property property">destroy</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Æ’<span class="token punctuation">,</span> Æ’<span class="token punctuation">]</span>
 <span class="token literal-property property">remove</span><span class="token operator">:</span> <span class="token punctuation">[</span>Æ’<span class="token punctuation">]</span>
 <span class="token literal-property property">update</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Æ’<span class="token punctuation">,</span> Æ’<span class="token punctuation">,</span> Æ’<span class="token punctuation">,</span> Æ’<span class="token punctuation">,</span> Æ’<span class="token punctuation">,</span> Æ’<span class="token punctuation">,</span> Æ’<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚ä¸‹é¢çš„ div ç»‘å®šäº†ç‚¹å‡»äº‹ä»¶ tapï¼Œè¿˜æœ‰ attr title å±æ€§ã€‚</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>txt<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ msg }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'hello'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">txt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">'aaa'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'&gt;&gt; tap :'</span><span class="token punctuation">)</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>ç¼–è¯‘ template åçš„ vnode.data æ•°æ®å¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code>data <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">attrs</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;aaa&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">on</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">click</span><span class="token operator">:</span> <span class="token function">Æ’</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">0</span>
  	<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;bound tap&quot;</span>
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>é€šè¿‡ isRenderedModule åˆ¤è¯»åªæœ‰ on æœªåœ¨æœåŠ¡ç«¯å¤„ç†è¿‡ï¼Œåˆ™ä¼šè°ƒç”¨ invokeCreateHooks å‡½æ•°ï¼Œè¿›è€Œå‡ºå‘ cb.create.updateDOMListeners è¿›è¡Œ DOM äº‹ä»¶ç»‘å®šæ³¨å†Œã€‚</p> <h2 id="invokeinserthook-å‡½æ•°"><a href="#invokeinserthook-å‡½æ•°" class="header-anchor">#</a> invokeInsertHook å‡½æ•°</h2> <p>åœ¨æ‰§è¡Œå®Œ hydrate å‡½æ•°é€»è¾‘ä¹‹åï¼Œä¼šè°ƒç”¨ï¼š<code>invokeInsertHook(vnode, insertedVnodeQueue, true)</code>ã€‚ç”¨äºå»¶è¿Ÿæ‰§è¡Œæ’å…¥ç»„ä»¶æ ¹èŠ‚ç‚¹çš„é’©å­ï¼Œç›´åˆ°å…ƒç´ èŠ‚ç‚¹è¢«æŒ‚åœ¨æ’å…¥åå†æ‰§è¡Œã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">invokeInsertHook</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> queue<span class="token punctuation">,</span> initial</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>initial<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>parent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¼‚æ­¥æ‰§è¡Œã€‚ç”±äºåœ¨æœåŠ¡ç«¯å·²ç»åˆå§‹åŒ–è¿‡äº†ï¼Œæ‰€ä»¥èµ°çš„æ˜¯å»¶è¿Ÿæ‰§è¡Œçš„é€»è¾‘</span>
    vnode<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>data<span class="token punctuation">.</span>pendingInsert <span class="token operator">=</span> queue<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// æœªåˆå§‹åŒ–è¿‡ï¼Œç›´æ¥æ‰§è¡Œ</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> queue<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      queue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>queue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// åœ¨ç»„ä»¶åˆå§‹åŒ–æ—¶ï¼Œä¼šåˆ¤æ–­ pendingInsert æ˜¯å¦å­˜åœ¨</span>
<span class="token comment">// æ˜¯çš„è¯åˆ™å°†å¼‚æ­¥é˜Ÿåˆ—ä¸­çš„æ•°æ®æ·»åŠ åˆ° insertedVnodeQueue åé¢</span>
<span class="token comment">// ç„¶åè°ƒç”¨ invokeCreateHooks ä¸€å¹¶æ‰§è¡Œã€‚</span>
<span class="token keyword">function</span> <span class="token function">initComponent</span> <span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> insertedVnodeQueue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>pendingInsert<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    insertedVnodeQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>insertedVnodeQueue<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>pendingInsert<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>pendingInsert <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> vnode<span class="token punctuation">.</span>componentInstance<span class="token punctuation">.</span>$el<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPatchable</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">invokeCreateHooks</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setScope</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// empty component root.</span>
    <span class="token comment">// skip all element-related modules except for ref (#3455)</span>
    <span class="token function">registerRef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// make sure to invoke the insert hook</span>
    insertedVnodeQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/blog/vue-ssr/vue-srr é¡¹ç›®æ­å»º.html" class="prev">
        vue-srr é¡¹ç›®æ­å»º
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/blog/assets/js/app.aa26872a.js" defer></script><script src="/blog/assets/js/2.9a122aa2.js" defer></script><script src="/blog/assets/js/59.af470f36.js" defer></script>
  </body>
</html>
