(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{501:function(t,s){t.exports="data:image/png;base64,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"},502:function(t,s,a){t.exports=a.p+"assets/img/websocket-02.a873224a.png"},556:function(t,s,a){"use strict";a.r(s);var n=a(18),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"http-https-协议"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http-https-协议"}},[t._v("#")]),t._v(" HTTP/HTTPS 协议")]),t._v(" "),n("ul",[n("li",[t._v("一个 "),n("strong",[t._v("request")]),t._v(" 对应一个 "),n("strong",[t._v("response")]),t._v("。一般使用 "),n("strong",[t._v("轮询")]),t._v(" 机制获取信息。")]),t._v(" "),n("li",[t._v("虽然后期有 "),n("strong",[t._v("keep-alive")]),t._v("，可以一次连接中处理多个 "),n("strong",[t._v("request")]),t._v(" 合并发送，接收多个 "),n("strong",[t._v("response")]),t._v("，对每个请求仍然需要单独发 "),n("strong",[t._v("header")]),t._v("。")]),t._v(" "),n("li",[n("strong",[t._v("HTTP")]),t._v(" 的 "),n("strong",[t._v("response")]),t._v(" 是被动的，通信只能由客户端发起，做不到服务端主动向客户端推送信息。")]),t._v(" "),n("li",[n("strong",[t._v("HTTP")]),t._v(" 是无状态协议。")]),t._v(" "),n("li",[t._v("需要三次握手。")]),t._v(" "),n("li",[t._v("HTTP：TCP + HTTP")]),t._v(" "),n("li",[t._v("HTTPS：TCP + HTTP + TLS")])]),t._v(" "),n("h4",{attrs:{id:"ajax-轮询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ajax-轮询"}},[t._v("#")]),t._v(" ajax 轮询")]),t._v(" "),n("p",[n("strong",[t._v("ajax 轮询")]),t._v(" 是指客户端 "),n("strong",[t._v("不断")]),t._v(" 向服务器发送资源请求 "),n("strong",[t._v("request")]),t._v("，服务端不管有无目标资源，都会返回 "),n("strong",[t._v("response")]),t._v(" 结果。这样就要求服务器拥有更好的处理速度。")]),t._v(" "),n("h4",{attrs:{id:"long-poll-长轮询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#long-poll-长轮询"}},[t._v("#")]),t._v(" long poll / 长轮询")]),t._v(" "),n("p",[n("strong",[t._v("long poll")]),t._v(" 比 "),n("strong",[t._v("ajax 轮询")]),t._v(" 好点，"),n("strong",[t._v("不会不断")]),t._v(" 向服务器发送资源请求 "),n("strong",[t._v("request")]),t._v("，一旦接受客户端的请求，有资源就返回；无资源就挂起，直到有资源才返回 "),n("strong",[t._v("response")]),t._v(" 结果（有且仅有返回一次）。高并发，需要服务器可以同时处理多个请求的能力。")]),t._v(" "),n("h2",{attrs:{id:"websocket-协议"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#websocket-协议"}},[t._v("#")]),t._v(" websocket 协议")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("websocket")]),t._v(" 是 "),n("strong",[t._v("html5")]),t._v(" 出的协议。")]),t._v(" "),n("li",[n("strong",[t._v("websocket")]),t._v(" 是一个持久化的协议，"),n("strong",[t._v("websocket")]),t._v(" 只需要一次请求（一次 "),n("strong",[t._v("HTTP 握手")]),t._v(" ），就可以得到所需的资源。")]),t._v(" "),n("li",[t._v("服务端可以 "),n("strong",[t._v("主动")]),t._v(" 向客户端推送信息，客户端也可以 "),n("strong",[t._v("主动")]),t._v(" 向服务端推送消息，实现“双向平等”，是属于服务器推送技术的一种。")]),t._v(" "),n("li",[t._v("与 "),n("strong",[t._v("HTTP")]),t._v(" 有较好的兼容性，在握手阶段采用 "),n("strong",[t._v("HTTP")]),t._v(" 协议。")]),t._v(" "),n("li",[t._v("默认端口 "),n("strong",[t._v("80")]),t._v(" and "),n("strong",[t._v("443")]),t._v("。")]),t._v(" "),n("li",[t._v("数据格式轻量，性能开销小，通信高效，可以发送文本，也可以二进制数据。")]),t._v(" "),n("li",[t._v("没有同源策略。")]),t._v(" "),n("li",[t._v("WS：TCP + WS")]),t._v(" "),n("li",[t._v("WSS：TCP + WS + TLS")])]),t._v(" "),n("h4",{attrs:{id:"websocket-握手"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#websocket-握手"}},[t._v("#")]),t._v(" websocket 握手")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("GET /chat HTTP/1.1\nHost: server.example.com\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw==\nSec-WebSocket-Protocol: chat, superchat\nSec-WebSocket-Version: 13\n")])])]),n("ul",[n("li",[t._v("Upgrade/Connection：通知服务器发起的是 "),n("strong",[t._v("wesocket")]),t._v(" 协议。")]),t._v(" "),n("li",[t._v("Sec-WebSocket-Key：浏览器随机生成的 "),n("strong",[t._v("Base64 encode")]),t._v(" 的值，用于验证服务器是不是 "),n("strong",[t._v("websocket 协议")]),t._v("。")]),t._v(" "),n("li",[t._v("Sec-WebSocket-Protocol：用户定义的字符串，用来区分 "),n("strong",[t._v("同 url")]),t._v(" 下，不同的服务所需要的协议。")]),t._v(" "),n("li",[t._v("Sec-WebSocket-Version：协议版本。")])]),t._v(" "),n("h4",{attrs:{id:"服务器返回"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#服务器返回"}},[t._v("#")]),t._v(" 服务器返回")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("HTTP/1.1 101 Switching Protocols\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Accept: HSmrc0sMlYUkAGmm5OPpG2HaGWk=\nSec-WebSocket-Protocol: chat\n")])])]),n("ul",[n("li",[t._v("Upgrade/Connection：通知客户端升级的是 "),n("strong",[t._v("websocket")]),t._v(" 协议。")]),t._v(" "),n("li",[t._v("Sec-WebSocket-Accept：经服务器确认，加密后的 "),n("strong",[t._v("Sec-WebSocket-Key")]),t._v("。")]),t._v(" "),n("li",[t._v("Sec-WebSocket-Protocol：最终使用的协议。")])]),t._v(" "),n("h4",{attrs:{id:"代码实现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码实现"}},[t._v("#")]),t._v(" 代码实现")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("ws"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'open'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Open the websocket...'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ws"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello websocket...'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nws"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'message'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Ready state: '")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" ws"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readyState"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Receive the websocket message...'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ws"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Ready state: '")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" ws"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readyState"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nws"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'close'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Ready state: '")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" ws"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readyState"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Close the websocket...'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("结果：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(501),alt:"image.png"}})]),t._v(" "),n("p",[t._v("参考：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(502),alt:"image.png"}})]),t._v(" "),n("ul",[n("li",[t._v("https://www.zhihu.com/search?type=content&q=websocket")]),t._v(" "),n("li",[t._v("http://www.ruanyifeng.com/blog/2017/05/websocket.html")])])])}),[],!1,null,null,null);s.default=e.exports}}]);